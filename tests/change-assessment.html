<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Change Ability Assessment | å€‹äººè®Šé©èƒ½åŠ›è©•ä¼°</title>
    <meta name="description" content="Professional assessment to evaluate your change management capabilities and adaptability skills in organizational environments.">

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <link rel="stylesheet" href="../assets/css/change-assessment.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <div class="assessment-container">
        <!-- Navigation Header -->
        <nav class="nav-header">
            <a href="../index.html" class="logo">
                <span class="text-en">Explore Yourself</span>
                <span class="text-zh" style="display: none;">æ¢ç´¢è‡ªæˆ‘</span>
            </a>
            <div class="nav-meta">
                <div class="language-toggle">
                    <button class="lang-btn active" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="zh">ä¸­æ–‡</button>
                </div>
                <a href="../index.html" class="back-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="text-en">Back to Home</span>
                    <span class="text-zh" style="display: none;">å›åˆ°é¦–é </span>
                </a>
            </div>
        </nav>

        <!-- Assessment Header -->
        <header class="assessment-header">
            <div class="header-content">
                <div class="assessment-icon">ğŸ”„</div>
                <h1 class="assessment-title">
                    <span class="text-en">Change Ability Assessment</span>
                    <span class="text-zh" style="display: none;">è®Šé©èƒ½åŠ›è©•ä¼°</span>
                </h1>
                <p class="assessment-subtitle">
                    <span class="text-en">Professional evaluation of your change management capabilities and organizational adaptability</span>
                    <span class="text-zh" style="display: none;">å°ˆæ¥­è©•ä¼°æ‚¨çš„è®Šé©ç®¡ç†èƒ½åŠ›å’Œçµ„ç¹”é©æ‡‰æ€§</span>
                </p>
                
                <div class="assessment-info">
                    <div class="info-stat">
                        <span class="stat-number">20</span>
                        <span class="stat-label">
                            <span class="text-en">Questions</span>
                            <span class="text-zh" style="display: none;">é¡Œç›®</span>
                        </span>
                    </div>
                    <div class="info-stat">
                        <span class="stat-number">5-8</span>
                        <span class="stat-label">
                            <span class="text-en">Minutes</span>
                            <span class="text-zh" style="display: none;">åˆ†é˜</span>
                        </span>
                    </div>
                    <div class="info-stat">
                        <span class="stat-number">3</span>
                        <span class="stat-label">
                            <span class="text-en">Ranges</span>
                            <span class="text-zh" style="display: none;">ç¯„åœ</span>
                        </span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Instructions Panel -->
        <section class="instructions-panel">
            <div class="instructions-content">
                <h3 class="instructions-title">
                    <span class="text-en">Assessment Instructions</span>
                    <span class="text-zh" style="display: none;">è©•ä¼°èªªæ˜</span>
                </h3>
                
                <div class="instructions-text">
                    <div class="text-en">
                        <p>This assessment evaluates your change management capabilities and adaptability in professional environments. Rate each statement based on how consistently it describes your behavior and approach to organizational change.</p>
                    </div>
                    <div class="text-zh" style="display: none;">
                        <p>æ­¤è©•ä¼°è©•ä¼°æ‚¨åœ¨å°ˆæ¥­ç’°å¢ƒä¸­çš„è®Šé©ç®¡ç†èƒ½åŠ›å’Œé©æ‡‰æ€§ã€‚è«‹æ ¹æ“šæ¯å€‹é™³è¿°å°æ‚¨çš„è¡Œç‚ºå’Œçµ„ç¹”è®Šé©æ–¹æ³•çš„ä¸€è‡´æ€§æè¿°ç¨‹åº¦é€²è¡Œè©•åˆ†ã€‚</p>
                    </div>
                </div>
                


                <div class="important-notes">
                    <div class="note-item">
                        <span class="note-icon">ğŸ’¡</span>
                        <span class="text-en">Answer based on your honest self-reflection</span>
                        <span class="text-zh" style="display: none;">è«‹æ ¹æ“šèª å¯¦çš„è‡ªæˆ‘åæ€ä½œç­”</span>
                    </div>
                    <div class="note-item">
                        <span class="note-icon">ğŸ¯</span>
                        <span class="text-en">Focus on consistent patterns, not isolated incidents</span>
                        <span class="text-zh" style="display: none;">è«‹é—œæ³¨ä¸€è‡´çš„æ¨¡å¼ï¼Œè€Œéå€‹åˆ¥äº‹ä»¶</span>
                    </div>
                    <div class="note-item">
                        <span class="note-icon">ğŸ“§</span>
                        <span class="text-en">Results will be emailed upon completion</span>
                        <span class="text-zh" style="display: none;">å®Œæˆå¾Œçµæœå°‡ä»¥é›»å­éƒµä»¶ç™¼é€</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assessment Form -->
        <main class="assessment-main">
            <form id="assessmentForm" class="assessment-form">
                <!-- Name Input Section -->
                <div class="name-input-section">
                    <div class="input-group">
                        <label for="studentName" class="input-label">
                            <span class="label-icon">ğŸ‘¤</span>
                            <span class="text-en">Your Full Name</span>
                            <span class="text-zh" style="display: none;">æ‚¨çš„çœŸå¯¦å§“å</span>
                            <span class="required-mark">*</span>
                        </label>
                        <input type="text" id="studentName" name="studentName" required 
                               class="name-input"
                               placeholder="Enter your full name / è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å">
                    </div>
                    
                    <div class="input-group">
                        <label for="studentEmail" class="input-label">
                            <span class="label-icon">ğŸ“§</span>
                            <span class="text-en">Your Email Address</span>
                            <span class="text-zh" style="display: none;">æ‚¨çš„é›»å­éƒµä»¶åœ°å€</span>
                            <span class="required-mark">*</span>
                        </label>
                        <input type="email" id="studentEmail" name="studentEmail" required 
                               class="name-input"
                               placeholder="Enter your email / è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶">
                    </div>
                </div>



                <!-- Questions Container -->
                <div id="questionsContainer" class="questions-container">
                    <!-- Questions will be populated by JavaScript -->
                </div>

                <!-- Submit Section -->
                <div class="submit-section">
                    <button type="submit" id="submitBtn" class="submit-button" disabled>
                        <span class="button-content">
                            <span class="button-icon">ğŸ“Š</span>
                            <span class="button-text">
                                <span class="text-en">Complete Assessment</span>
                                <span class="text-zh" style="display: none;">å®Œæˆè©•ä¼°</span>
                            </span>
                        </span>
                        <div class="button-shine"></div>
                    </button>
                    
                    <p class="submit-note">
                        <span class="text-en">Your results will be processed and emailed to you instantly</span>
                        <span class="text-zh" style="display: none;">æ‚¨çš„çµæœå°‡ç«‹å³è™•ç†ä¸¦é€šéé›»å­éƒµä»¶ç™¼é€çµ¦æ‚¨</span>
                    </p>
                </div>
            </form>
        </main>

        </div>
    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("I2KqoGsE81K29GmFC");

        // Language Toggle Functionality with inheritance from homepage
        function initializeLanguageToggle() {
            // Get language preference from sessionStorage for consistency
            const savedLang = sessionStorage.getItem('selectedLanguage') || 'en';
            
            const langButtons = document.querySelectorAll('.lang-btn');
            const enElements = document.querySelectorAll('.text-en');
            const zhElements = document.querySelectorAll('.text-zh');
            
            // Apply saved language immediately
            if (savedLang === 'zh') {
                langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === 'zh'));
                enElements.forEach(el => el.style.display = 'none');
                zhElements.forEach(el => el.style.display = '');
                document.documentElement.lang = 'zh-TW';
                updatePlaceholders('zh');
            } else {
                langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === 'en'));
                enElements.forEach(el => el.style.display = '');
                zhElements.forEach(el => el.style.display = 'none');
                document.documentElement.lang = 'en';
                updatePlaceholders('en');
            }
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const lang = btn.dataset.lang;
                    
                    // Update button states
                    langButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Save language preference to sessionStorage
                    sessionStorage.setItem('selectedLanguage', lang);
                    
                    // Toggle language visibility
                    if (lang === 'en') {
                        enElements.forEach(el => el.style.display = '');
                        zhElements.forEach(el => el.style.display = 'none');
                        document.documentElement.lang = 'en';
                        updatePlaceholders('en');
                    } else {
                        enElements.forEach(el => el.style.display = 'none');
                        zhElements.forEach(el => el.style.display = '');
                        document.documentElement.lang = 'zh-TW';
                        updatePlaceholders('zh');
                    }
                    
                    // Regenerate questions in the new language
                    generateQuestions();
                });
            });
        }

        function updatePlaceholders(lang) {
            const nameInput = document.getElementById('studentName');
            const emailInput = document.getElementById('studentEmail');
            if (lang === 'en') {
                nameInput.placeholder = 'Enter your full name';
                emailInput.placeholder = 'Enter your email address';
            } else {
                nameInput.placeholder = 'è«‹è¼¸å…¥æ‚¨çš„çœŸå¯¦å§“å';
                emailInput.placeholder = 'è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶';
            }
        }

        // Assessment Questions Data - Re-aligned with original PDF, with improved wording.
        const questions = {
            en: [
                "1. I make it a practice to communicate frequently and transparently with my team, even on difficult topics.",
                "2. I believe that if people understand the reasons for a change, formal training is often an unnecessary extra step.",
                "3. I actively encourage my team to experiment with new practices and technologies to foster continuous improvement.",
                "4. When planning for change, I consistently consider our culture and values alongside other ongoing initiatives.",
                "5. When faced with unexpected changes, my expectation is that people should be able to adapt and move forward without delay.",
                "6. I see employee dissatisfaction with a current process as a strong indicator that a change will be welcomed and more easily adopted.",
                "7. I generally expect that if other teams or individuals need clarification on a change, they will take the initiative to ask.",
                "8. When planning for change, I make it a point to solicit and integrate the ideas of those who will be directly impacted.",
                "9. I am proactive in seeking out the data and information necessary to fully understand and personally support a change initiative.",
                "10. I consistently factor in the impact on people and organizational structure when planning a change project.",
                "11. I believe that once key leaders communicate the necessity of a change, the rest of the organization will naturally get on board.",
                "12. I am skilled at inspiring others to embrace change by articulating a clear and compelling vision for the future.",
                "13. I feel a sense of unease when I have to make plans and decisions in situations involving risk or uncertainty.",
                "14. When implementing change, I set regular, achievable milestones to keep the team engaged and motivated.",
                "15. During times of change, I am intentionally visible and available to my team, serving as a role model for the desired behaviors.",
                "16. When I encounter resistance to change, I proactively reach out to my peers for advice on how to best respond.",
                "17. I view change management as a specialized role; it's a task for designated professionals, not a core part of my own job.",
                "18. I have a talent for considering an idea from a wide variety of viewpoints to determine the best path forward.",
                "19. I build and leverage my internal networks to effectively share information, gather diverse perspectives, and test new ideas.",
                "20. I hold myself personally accountable for the effective implementation of change within my team."
            ],
            zh: [
                "1. æˆ‘ç¿’æ…£èˆ‡åœ˜éšŠä¿æŒé »ç¹ä¸”é€æ˜çš„æºé€šï¼Œå³ä½¿åœ¨è¨è«–å›°é›£è­°é¡Œæ™‚ä¹Ÿæ˜¯å¦‚æ­¤ã€‚",
                "2. æˆ‘ç›¸ä¿¡ï¼Œå¦‚æœäººå€‘ç†è§£äº†è®Šé©çš„åŸå› ï¼Œé‚£éº¼æ­£å¼çš„åŸ¹è¨“å¾€å¾€æ˜¯ä¸å¿…è¦çš„é¡å¤–æ­¥é©Ÿã€‚",
                "3. æˆ‘ç©æ¥µé¼“å‹µæˆ‘çš„åœ˜éšŠå˜—è©¦æ–°çš„ä½œæ³•å’ŒæŠ€è¡“ï¼Œä»¥ä¿ƒé€²æŒçºŒçš„é€²æ­¥ã€‚",
                "4. åœ¨è¦åŠƒè®Šé©æ™‚ï¼Œæˆ‘ç¸½æœƒä¸€ä½µè€ƒé‡æˆ‘å€‘çš„æ–‡åŒ–ã€åƒ¹å€¼è§€ä»¥åŠå…¶ä»–æ­£åœ¨é€²è¡Œçš„å°ˆæ¡ˆã€‚",
                "5. ç•¶é¢å°çªå¦‚å…¶ä¾†çš„è®ŠåŒ–æ™‚ï¼Œæˆ‘æœŸæœ›äººå€‘èƒ½å¤ ä¸å»¶é²åœ°é©æ‡‰ä¸¦ç¹¼çºŒå‰é€²ã€‚",
                "6. æˆ‘å°‡å“¡å·¥å°ç•¶å‰æµç¨‹çš„ä¸æ»¿ï¼Œè¦–ç‚ºä¸€å€‹å¼·çƒˆçš„ä¿¡è™Ÿï¼Œä»£è¡¨è®Šé©æœƒå—åˆ°æ­¡è¿ä¸”æ›´å®¹æ˜“è¢«æ¡ç´ã€‚",
                "7. æˆ‘é€šå¸¸é æœŸï¼Œå¦‚æœå…¶ä»–åœ˜éšŠæˆ–å€‹äººéœ€è¦å°æŸé …è®Šé©é€²è¡Œæ¾„æ¸…ï¼Œä»–å€‘æœƒä¸»å‹•æå‡ºè©¢å•ã€‚",
                "8. åœ¨è¦åŠƒè®Šé©æ™‚ï¼Œæˆ‘æœƒç‰¹åˆ¥å¾µæ±‚ä¸¦æ•´åˆé‚£äº›å°‡å—åˆ°ç›´æ¥å½±éŸ¿çš„äººçš„æƒ³æ³•ã€‚",
                "9. æˆ‘æœƒç©æ¥µå°‹æ‰¾å¿…è¦çš„æ•¸æ“šå’Œè³‡è¨Šï¼Œä»¥ä¾¿å®Œå…¨ç†è§£ä¸¦è¦ªèº«æ”¯æŒä¸€é …è®Šé©è¨ˆåŠƒã€‚",
                "10. åœ¨è¦åŠƒè®Šé©å°ˆæ¡ˆæ™‚ï¼Œæˆ‘ç¸½æœƒå°‡å…¶å°äººå“¡å’Œçµ„ç¹”çµæ§‹çš„å½±éŸ¿ç´å…¥è€ƒé‡ã€‚",
                "11. æˆ‘ç›¸ä¿¡ï¼Œä¸€æ—¦é—œéµé ˜å°è€…å‚³é”äº†è®Šé©çš„å¿…è¦æ€§ï¼Œçµ„ç¹”çš„å…¶ä»–æˆå“¡è‡ªç„¶æœƒè·Ÿé€²ã€‚",
                "12. æˆ‘æ“…é•·é€éé—¡è¿°ä¸€å€‹æ¸…æ™°ä¸”å¼•äººæ³¨ç›®çš„æœªä¾†é¡˜æ™¯ï¼Œä¾†æ¿€å‹µä»–äººæ“æŠ±è®Šé©ã€‚",
                "13. ç•¶æˆ‘å¿…é ˆåœ¨å……æ»¿é¢¨éšªæˆ–ä¸ç¢ºå®šæ€§çš„æƒ…æ³ä¸‹åˆ¶å®šè¨ˆåŠƒå’Œæ±ºç­–æ™‚ï¼Œæˆ‘æœƒæ„Ÿåˆ°ä¸å®‰ã€‚",
                "14. åœ¨å¯¦æ–½è®Šé©æ™‚ï¼Œæˆ‘æœƒè¨­å®šå®šæœŸä¸”å¯å¯¦ç¾çš„é‡Œç¨‹ç¢‘ï¼Œä»¥ä¿æŒåœ˜éšŠçš„åƒèˆ‡æ„Ÿå’Œå‹•åŠ›ã€‚",
                "15. åœ¨è®Šé©æœŸé–“ï¼Œæˆ‘æœƒåˆ»æ„è®“è‡ªå·±ä¿æŒé«˜èƒ½è¦‹åº¦ã€éš¨æ™‚èƒ½è¢«åœ˜éšŠæ‰¾åˆ°ï¼Œä¸¦ä»¥èº«ä½œå‰‡ï¼Œç¤ºç¯„æ‰€æœŸæœ›çš„è¡Œç‚ºã€‚",
                "16. ç•¶æˆ‘é‡åˆ°å°è®Šé©çš„é˜»åŠ›æ™‚ï¼Œæˆ‘æœƒä¸»å‹•å‘åŒäº‹å°‹æ±‚å¦‚ä½•æœ€ä½³æ‡‰å°çš„å»ºè­°ã€‚",
                "17. æˆ‘èªç‚ºè®Šé©ç®¡ç†æ˜¯ä¸€é …å°ˆæ¥­è·èƒ½ï¼Œæ‡‰ç”±æŒ‡å®šçš„å°ˆå®¶è² è²¬ï¼Œè€Œä¸æ˜¯æˆ‘è‡ªå·±å·¥ä½œçš„æ ¸å¿ƒéƒ¨åˆ†ã€‚",
                "18. æˆ‘æ“…é•·å¾å¤šå…ƒçš„è§€é»ä¾†è€ƒæ…®ä¸€å€‹æƒ³æ³•ï¼Œä»¥æ±ºå®šæœ€ä½³çš„å‰é€²æ–¹å‘ã€‚",
                "19. æˆ‘æœƒå»ºç«‹ä¸¦åˆ©ç”¨æˆ‘çš„äººè„ˆç¶²çµ¡ï¼Œä¾†æœ‰æ•ˆåœ°åˆ†äº«è³‡è¨Šã€æ”¶é›†ä¸åŒè§€é»ä¸¦æ¸¬è©¦æ–°æƒ³æ³•ã€‚",
                "20. æˆ‘èªç‚ºæˆ‘å€‹äººå°æ–¼åœ¨åœ˜éšŠå…§æœ‰æ•ˆå¯¦æ–½è®Šé©è² æœ‰è²¬ä»»ã€‚"
            ]
        };

        // Items that are reverse scored, as per the original PDF. (1-indexed)
        const reverseScoreItems = [2, 5, 7, 11, 13, 17];

        // Progress Tracking
        let currentProgress = 0;
        const totalQuestions = 20;

        // Create and shuffle the question order
        const randomizedOrder = Array.from({ length: totalQuestions }, (_, i) => i);
        // Fisher-Yates shuffle algorithm
        for (let i = randomizedOrder.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [randomizedOrder[i], randomizedOrder[j]] = [randomizedOrder[j], randomizedOrder[i]];
        }

        function updateProgress() {
            const progressNumber = document.getElementById('progressNumber');
            const progressRing = document.getElementById('progressRing');
            
            const percentage = Math.round((currentProgress / totalQuestions) * 100);
            
            // Update text
            progressNumber.textContent = currentProgress;
            
            // Update circular progress bar
            const circumference = 2 * Math.PI * 25; // radius is 25
            const offset = circumference - (percentage / 100) * circumference;
            progressRing.style.strokeDasharray = circumference;
            progressRing.style.strokeDashoffset = offset;
        }

        // Generate Questions
        function generateQuestions() {
            const container = document.getElementById('questionsContainer');
            const currentLang = document.querySelector('.lang-btn.active').dataset.lang;
            const questionSet = questions[currentLang];
            
            container.innerHTML = '';
            
            randomizedOrder.forEach((originalIndex, i) => {
                const question = questionSet[originalIndex];
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.dataset.originalIndex = originalIndex; // Store original index

                const labels = currentLang === 'en' ? 
                    ['Strongly disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly agree'] :
                    ['éå¸¸ä¸åŒæ„', 'ä¸åŒæ„', 'ä¸­ç«‹', 'åŒæ„', 'éå¸¸åŒæ„'];

                questionDiv.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">${i + 1}</span>
                        <p class="question-text">${question}</p>
                    </div>
                    <div class="rating-container">
                        <div class="rating-options">
                            ${labels.map((label, value) => `
                            <div class="rating-option">
                                <input type="radio" id="q${i}_${value + 1}" name="q${i}" value="${value + 1}" required data-question="${i}">
                                <label for="q${i}_${value + 1}" class="rating-label">
                                    <span class="rating-number">${value + 1}</span>
                                    <span class="rating-text">${label}</span>
                                </label>
                            </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(questionDiv);
            });

            // Add event listeners for progress tracking
            const radioButtons = container.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', () => {
                    updateProgressFromAnswers();
                });
            });
        }

        function updateProgressFromAnswers() {
            const answeredQuestions = new Set();
            const radioButtons = document.querySelectorAll('#questionsContainer input[type="radio"]:checked');
            
            radioButtons.forEach(radio => {
                answeredQuestions.add(radio.name);
            });
            
            currentProgress = answeredQuestions.size;
            updateProgress();
            
            // Enable submit button when all questions are answered
            const submitBtn = document.getElementById('submitBtn');
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            
            if (currentProgress === totalQuestions && studentName && studentEmail) {
                submitBtn.disabled = false;
                submitBtn.classList.add('ready');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.remove('ready');
            }
        }

        // Form Submission
        document.getElementById('assessmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            const currentLang = document.querySelector('.lang-btn.active').dataset.lang;
            
            // Validate inputs
            if (!studentName) {
                alert(currentLang === 'en' ? 'Please enter your name.' : 'è«‹è¼¸å…¥æ‚¨çš„å§“åã€‚');
                return;
            }
            
            if (!studentEmail) {
                alert(currentLang === 'en' ? 'Please enter your email address.' : 'è«‹è¼¸å…¥æ‚¨çš„é›»å­éƒµä»¶åœ°å€ã€‚');
                return;
            }
            
            // Collect answers and apply reverse scoring
            const answers = [];
            const rawAnswers = [];
            let totalScore = 0;
            
            const questionItems = document.querySelectorAll('.question-item');
            questionItems.forEach((q_item, i) => {
                const checkedRadio = q_item.querySelector(`input[name="q${i}"]:checked`);
                if (checkedRadio) {
                    const originalIndex = parseInt(q_item.dataset.originalIndex, 10);
                    const rawValue = parseInt(checkedRadio.value, 10);
                    
                    rawAnswers[originalIndex] = rawValue; // Store raw answer by original index

                    // Apply reverse scoring for specific questions (using 1-based index)
                    if (reverseScoreItems.includes(originalIndex + 1)) {
                        const scoredValue = 6 - rawValue;
                        answers[originalIndex] = scoredValue;
                        totalScore += scoredValue;
                    } else {
                        answers[originalIndex] = rawValue;
                        totalScore += rawValue;
                    }
                }
            });
            
            // Calculate results
            const averageScore = (totalScore / totalQuestions).toFixed(2);
            
            // Determine result category based on score ranges from assessment document
            let resultCategory, resultDescription;
            if (totalScore >= 81) {
                resultCategory = currentLang === 'en' ? 'Change Champion (81-100)' : 'è®Šé©å† è» (81-100)';
                resultDescription = currentLang === 'en' ? 
                    'Change is easy for you. You\'re confident, flexible, and optimistic, though at times you can appear undisciplined and impulsive as you rapidly introduce or adopt change. You have a good understanding of what makes for successful change and how to manage and implement change. You prefer a fast rate of change, which can be intimidating to others. You readily step up to new challenges and enjoy risk and uncertainty. Be careful you don\'t get carried away by your self-confidence and the appeal of the new, ensure that you build upon past successes and critically assess whether change is actually needed.' :
                    'è®Šé©å°ä½ ä¾†èªªå¾ˆå®¹æ˜“ã€‚ä½ è‡ªä¿¡ã€éˆæ´»ã€æ¨‚è§€ï¼Œå„˜ç®¡æœ‰æ™‚ä½ åœ¨å¿«é€Ÿå¼•å…¥æˆ–æ¡ç”¨è®Šé©æ™‚æœƒé¡¯å¾—ç¼ºä¹ç´€å¾‹å’Œè¡å‹•ã€‚ä½ éå¸¸ç­è§£ä»€éº¼æ˜¯æˆåŠŸçš„è®Šé©ï¼Œä»¥åŠå¦‚ä½•ç®¡ç†å’Œå¯¦æ–½è®Šé©ã€‚ä½ å–œæ­¡å¿«é€Ÿçš„è®Šé©ï¼Œé€™å¯èƒ½æœƒè®“å…¶ä»–äººæœ›è€Œç”Ÿç•ã€‚ä½ æ¨‚æ–¼è¿æ¥æ–°çš„æŒ‘æˆ°ï¼Œäº«å—é¢¨éšªå’Œä¸ç¢ºå®šæ€§ã€‚è¦æ³¨æ„ä¸è¦è¢«ä½ çš„è‡ªä¿¡å’Œæ–°äº‹ç‰©çš„å¸å¼•åŠ›è¡æ˜é ­è…¦ï¼Œç¢ºä¿åœ¨éå»æˆåŠŸçš„åŸºç¤ä¸Šå†æ¥å†å²ï¼Œä¸¦èªçœŸè©•ä¼°æ˜¯å¦çœŸçš„éœ€è¦è®Šé©ã€‚';
            } else if (totalScore >= 47) {
                resultCategory = currentLang === 'en' ? 'Change Adapter (47-80)' : 'è®Šé©é©æ‡‰è€… (47-80)';
                resultDescription = currentLang === 'en' ? 
                    'You tend to manage change with a thought-out plan and are good at managing routine, expected changes, but the unexpected can still throw you off balance. Even the best-laid plans can fall apart and you may notice that your enthusiasm waxes and wanes over time. You can tend to be more focused on pragmatic results rather than structure, be aware that you may need to revise your change tactics along the way. You may be seen by others as able to see both sides of an argument and to influence key stakeholders who may or may not support the planned change. Using a process and change roadmap that allows you to manage the key phases of change will increase your effectiveness. As you develop your skills in this area, your ability to cope with the unexpectedâ€”and to help others copeâ€”will continue to grow.' :
                    'ä½ å‚¾å‘æ–¼ç”¨æ·±æ€ç†Ÿæ…®çš„è¨ˆç•«ä¾†æ‡‰å°è®ŠåŒ–ï¼Œä¸¦ä¸”å–„æ–¼è™•ç†å¸¸è¦çš„ã€é æœŸçš„è®ŠåŒ–ï¼Œä½†æ„å¤–é‚„æ˜¯æœƒè®“ä½ å¤±å»å¹³è¡¡ã€‚å³ä½¿æ˜¯æœ€å‘¨å¯†çš„è¨ˆç•«ä¹Ÿå¯èƒ½æœƒå¤±æ•—ï¼Œä½ å¯èƒ½æœƒæ³¨æ„åˆ°è‡ªå·±çš„ç†±æƒ…æœƒéš¨è‘—æ™‚é–“çš„æ¨ç§»è€Œæ¸›é€€ã€‚ä½ å¯èƒ½æœƒæ›´æ³¨é‡å¯¦éš›çµæœè€Œä¸æ˜¯çµæ§‹ï¼Œè¦æ³¨æ„ä½ å¯èƒ½éœ€è¦ä¿®æ­£ä½ çš„è®Šé©ç­–ç•¥ã€‚åœ¨ä»–äººçœ¼ä¸­ï¼Œä½ å¯èƒ½èƒ½å¤ çœ‹åˆ°çˆ­è«–çš„æ­£åå…©é¢ï¼Œä¸¦èƒ½å½±éŸ¿é‚£äº›å¯èƒ½æ”¯æŒæˆ–ä¸æ”¯æŒè®Šé©è¨ˆç•«çš„é—œéµåˆ©ç›Šç›¸é—œè€…ã€‚ä½¿ç”¨æµç¨‹å’Œè®Šé©è·¯ç·šåœ–ï¼Œè®“ä½ èƒ½å¤ ç®¡ç†è®Šé©çš„é—œéµéšæ®µï¼Œé€™å°‡æé«˜ä½ çš„æ•ˆç‡ã€‚éš¨è‘—ä½ åœ¨é€™æ–¹é¢æŠ€èƒ½çš„æé«˜ï¼Œä½ æ‡‰å°çªç™¼äº‹ä»¶çš„èƒ½åŠ›-ä»¥åŠå¹«åŠ©ä»–äººæ‡‰å°çªç™¼äº‹ä»¶çš„èƒ½åŠ›-ä¹Ÿå°‡ä¸æ–·å¢å¼·ã€‚';
            } else {
                resultCategory = currentLang === 'en' ? 'Change Developer (20-46)' : 'è®Šé©ç™¼å±•è€… (20-46)';
                resultDescription = currentLang === 'en' ? 
                    'You are deliberate, disciplined and organized, and do an excellent job of making sure procedures are followed. Your approach to change tends to be to react to it, not to meet it head-on. Although you may feel ready for change, you aren\'t as mentally prepared as you could be and prefer an element of predictability. Perhaps you aren\'t convinced it\'s really necessary to change at this point. To be successful in leading change you need to focus on articulating the vision and excitement of the end goal to your team and other key stakeholders. Taking control of your reactions may help you minimize the stress and confusion change can bring to you and others.' :
                    'ä½ æ·±æ€ç†Ÿæ…®ã€åš´è¬¹æœ‰åºï¼Œåœ¨ç¢ºä¿ç¨‹å¼å¾—åˆ°éµå®ˆæ–¹é¢åšå¾—éå¸¸å‡ºè‰²ã€‚ä½ å°å¾…è®Šé©çš„æ…‹åº¦å¾€å¾€æ˜¯åæ‡‰å¼ï¼Œè€Œä¸æ˜¯è¿é›£è€Œä¸Šã€‚é›–ç„¶ä½ å¯èƒ½è¦ºå¾—è‡ªå·±å·²ç¶“åšå¥½äº†æ”¹è®Šçš„æº–å‚™ï¼Œä½†ä½ çš„å¿ƒç†æº–å‚™ä¸¦ä¸å……åˆ†ï¼Œä½ æ›´å–œæ­¡å¯é è¦‹æ€§ã€‚ä¹Ÿè¨±ä½ é‚„ä¸ç›¸ä¿¡æ­¤æ™‚æ­¤åˆ»çœŸçš„æœ‰å¿…è¦é€²è¡Œè®Šé©ã€‚è¦æƒ³æˆåŠŸé ˜å°è®Šé©ï¼Œä½ éœ€è¦é›†ä¸­ç²¾åŠ›å‘åœ˜éšŠå’Œå…¶ä»–ä¸»è¦åˆ©ç›Šç›¸é—œè€…é—¡è¿°æœ€çµ‚ç›®æ¨™çš„é¡˜æ™¯å’Œèˆˆå¥®é»ã€‚æ§åˆ¶è‡ªå·±çš„åæ‡‰å¯ä»¥å¹«åŠ©ä½ æœ€å¤§é™åº¦åœ°æ¸›å°‘è®Šé©çµ¦ä½ å’Œä»–äººå¸¶ä¾†çš„å£“åŠ›å’Œå›°æƒ‘ã€‚';
            }
            
            // Prepare email content
            const emailContent = `
                Student Name: ${studentName}
                Assessment: Personal Change Ability Assessment
                Completion Date: ${new Date().toLocaleString()}
                
                Results Summary:
                Total Score: ${totalScore}/${totalQuestions * 5}
                Average Score: ${averageScore}/5.0
                Result Category: ${resultCategory}
                
                Description: ${resultDescription}
                
                Individual Question Responses (Raw â†’ Scored):
                ${[...Array(totalQuestions).keys()].map(index => {
                    const rawAnswer = rawAnswers[index];
                    const scoredAnswer = answers[index];
                    const isReversed = reverseScoreItems.includes(index + 1);
                    return `Question ${index + 1}: ${rawAnswer}/5${isReversed ? ` â†’ ${scoredAnswer}/5 (reversed)` : ''}`;
                }).join('\n')}
            `;
            
            try {
                // Store results and redirect
                sessionStorage.setItem('assessmentResults', JSON.stringify({
                    studentName,
                    testType: 'Change Ability Assessment',
                    totalScore,
                    averageScore,
                    resultCategory,
                    resultDescription,
                    answers: answers,        // scored answers
                    rawAnswers: rawAnswers,  // raw answers before reverse scoring
                    reverseItems: reverseScoreItems,
                    completionDate: new Date().toLocaleString()
                }));
                
                // Try to send email but don't block on failure
                try {
                    // Prepare multilingual email content
                    const emailData = {
                        student_name: studentName,
                        student_email: studentEmail || document.getElementById('studentEmail').value,
                        test_type: currentLang === 'en' ? "Personal Change Ability Assessment" : "å€‹äººè®Šé©èƒ½åŠ›è‡ªæˆ‘è©•ä¼°",
                        completion_date: new Date().toLocaleDateString(),
                        message: emailContent,
                        
                        // Header content
                        header_emoji: "ğŸ”„",
                        header_title: currentLang === 'en' ? "Assessment Complete" : "è©•ä¼°å®Œæˆ",
                        
                        // Greeting and messages
                        greeting: currentLang === 'en' ? "Hello" : "æ‚¨å¥½",
                        completion_message: currentLang === 'en' ? 
                            "Thank you for completing the Personal Change Ability Assessment! Your comprehensive results are ready." :
                            "æ„Ÿè¬æ‚¨å®Œæˆå€‹äººè®Šé©èƒ½åŠ›è‡ªæˆ‘è©•ä¼°ï¼æ‚¨çš„è©³ç´°çµæœå·²æº–å‚™å¥½ã€‚",
                            
                        // Results section
                        results_title: currentLang === 'en' ? "Your Assessment Results" : "æ‚¨çš„è©•ä¼°çµæœ",
                        main_score: `${averageScore}/5.0`,
                        score_label: currentLang === 'en' ? "Average Score" : "å¹³å‡åˆ†æ•¸",
                        result_category: resultCategory,
                        result_description: resultDescription,
                        
                        // Insights
                        insights_title: currentLang === 'en' ? "Key Insights" : "é‡è¦æ´å¯Ÿ",
                        insights_text: currentLang === 'en' ? 
                            "These results reflect your current readiness and skills for managing change. Use these insights to identify areas for development and leverage your strengths." :
                            "é€™äº›çµæœåæ˜ äº†æ‚¨ç›®å‰ç®¡ç†è®Šé©çš„æº–å‚™åº¦å’ŒæŠ€èƒ½ã€‚è«‹åˆ©ç”¨é€™äº›æ´å¯Ÿä¾†è­˜åˆ¥ç™¼å±•é ˜åŸŸä¸¦ç™¼æ®æ‚¨çš„å„ªå‹¢ã€‚",
                            
                        // Footer content
                        detailed_title: currentLang === 'en' ? "Detailed Breakdown" : "è©³ç´°åˆ†æ",
                        completion_date_label: currentLang === 'en' ? "Assessment completed on:" : "è©•ä¼°å®Œæˆæ—¥æœŸï¼š",
                        questions_text: currentLang === 'en' ? "Questions about your results?" : "å°çµæœæœ‰ç–‘å•ï¼Ÿ",
                        disclaimer_text: currentLang === 'en' ? 
                            "This assessment is designed for educational and self-development purposes. Results should be used as a guide for personal reflection and growth." :
                            "æ­¤è©•ä¼°ç”¨æ–¼æ•™è‚²å’Œè‡ªæˆ‘ç™¼å±•ç›®çš„ã€‚çµæœæ‡‰ä½œç‚ºå€‹äººåæ€å’Œæˆé•·çš„æŒ‡å—ã€‚",
                        footer_brand: currentLang === 'en' ? "Personality Assessment Team" : "äººæ ¼è©•ä¼°æ¸¬è©¦åœ˜éšŠ",
                        footer_subtitle: currentLang === 'en' ? "Professional Psychological Evaluation" : "å°ˆæ¥­å¿ƒç†è©•ä¼°",
                        breakdown_section: "" // Empty for change assessment
                    };
                    
                    // Send to user
                    await emailjs.send("service_2mndbrx", "template_z0l98oa", emailData);
                    
                    // Send to admin (always in English for admin)
                    const adminEmailData = { ...emailData };
                    adminEmailData.student_email = "felicco@gmail.com";
                    adminEmailData.test_type = "Personal Change Ability Assessment";
                    adminEmailData.header_title = "Assessment Complete";
                    adminEmailData.greeting = "Hello";
                    adminEmailData.completion_message = `${studentName} has completed the Personal Change Ability Assessment. Results summary attached.`;
                    
                    await emailjs.send("service_2mndbrx", "template_z0l98oa", adminEmailData);
                    
                    console.log('Emails sent successfully');
                } catch (emailError) {
                    console.log('Email failed but continuing to results:', emailError);
                }
                
                window.location.href = 'results.html';
                
            } catch (error) {
                console.error('Error processing assessment:', error);
                alert(currentLang === 'en' ? 
                    'There was an error processing your results. Please try again.' :
                    'è™•ç†æ‚¨çš„çµæœæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡è©¦ã€‚');
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeLanguageToggle();
            generateQuestions();
            updateProgress();
            
            // Add input listeners for real-time validation
            document.getElementById('studentName').addEventListener('input', updateProgressFromAnswers);
            document.getElementById('studentEmail').addEventListener('input', updateProgressFromAnswers);
        });
    </script>

    <!-- Floating Progress Indicator -->
    <div id="progressIndicator" class="floating-progress">
        <div class="progress-circle">
            <svg class="progress-ring" width="60" height="60">
                <circle class="progress-ring-background" cx="30" cy="30" r="25"></circle>
                <circle class="progress-ring-progress" cx="30" cy="30" r="25" id="progressRing"></circle>
            </svg>
            <div class="progress-text">
                <span id="progressNumber">0</span>
                <span class="progress-total">/20</span>
            </div>
        </div>
        <div class="progress-label-text">
            <span class="text-en">Progress</span>
            <span class="text-zh" style="display: none;">é€²åº¦</span>
        </div>
    </div>
</body>
</html> 