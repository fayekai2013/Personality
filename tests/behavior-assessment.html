<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Communication Style Assessment | 個人溝通風格評估</title>
    <meta name="description" content="Professional assessment to identify your primary communication patterns and behavioral tendencies in interpersonal interactions.">

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <link rel="stylesheet" href="../assets/css/behavior-assessment.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <div class="assessment-container">
        <!-- Navigation Header -->
        <nav class="nav-header">
            <a href="../index.html" class="logo">
                <span class="text-en">Explore Yourself</span>
                <span class="text-zh" style="display: none;">探索自我</span>
            </a>
            <div class="nav-meta">
                <div class="language-toggle">
                    <button class="lang-btn active" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="zh">中文</button>
                </div>
                <a href="../index.html" class="back-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="text-en">Back to Home</span>
                    <span class="text-zh" style="display: none;">回到首頁</span>
                </a>
            </div>
        </nav>

        <!-- Assessment Header -->
        <header class="assessment-header">
            <div class="header-content">
                <div class="assessment-icon">🧠</div>
                <h1 class="assessment-title">
                    <span class="text-en">Your Authentic Communication Style</span>
                    <span class="text-zh" style="display: none;">您真實的溝通風格</span>
                </h1>
                <p class="assessment-subtitle">
                    <span class="text-en">Discover how you naturally communicate and process information. Through 60 questions, you'll uncover your authentic communication style—how you absorb information, make decisions, and connect with others.</span>
                    <span class="text-zh" style="display: none;">發現你自然的溝通和資訊處理方式。透過 60 道題目，揭示你真實的溝通風格——你如何吸收資訊、做決定、與他人連結。</span>
                </p>
                
                <div class="assessment-info">
                    <div class="info-stat">
                        <span class="stat-number">60</span>
                        <span class="stat-label">
                            <span class="text-en">Questions</span>
                            <span class="text-zh" style="display: none;">題目</span>
                        </span>
                    </div>
                    <div class="info-stat">
                        <span class="stat-number">8-12</span>
                        <span class="stat-label">
                            <span class="text-en">Minutes</span>
                            <span class="text-zh" style="display: none;">分鐘</span>
                        </span>
                    </div>
                    <div class="info-stat">
                        <span class="stat-number">6</span>
                        <span class="stat-label">
                            <span class="text-en">Types</span>
                            <span class="text-zh" style="display: none;">類型</span>
                        </span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Instructions Panel -->
        <section class="instructions-panel">
            <div class="instructions-content">
                <h3 class="instructions-title">
                    <span class="text-en">Assessment Instructions</span>
                    <span class="text-zh" style="display: none;">評估說明</span>
                </h3>
                
                <div class="instructions-text">
                    <div class="text-en">
                        <p>This assessment evaluates your natural communication patterns and information processing style. Answer each question based on how you typically behave and think. There are no right or wrong answers—respond honestly to get accurate results.</p>
                    </div>
                    <div class="text-zh" style="display: none;">
                        <p>此評估評估您自然的溝通模式和資訊處理風格。請根據您通常的行為和思考方式回答每個問題。沒有對錯答案——誠實回答以獲得準確結果。</p>
                    </div>
                </div>
                


                <div class="important-notes">
                    <div class="note-item">
                        <span class="note-icon">💡</span>
                        <span class="text-en">Trust your first instinct - it's usually the most authentic</span>
                        <span class="text-zh" style="display: none;">相信您的第一直覺，通常是最真實的</span>
                    </div>
                    <div class="note-item">
                        <span class="note-icon">🌈</span>
                        <span class="text-en">Every answer is valid - this is about discovering your unique style</span>
                        <span class="text-zh" style="display: none;">每個答案都是有效的，這是為了發現您獨特的風格</span>
                    </div>
                    <div class="note-item">
                        <span class="note-icon">🎁</span>
                        <span class="text-en">Your personalized insights will be delivered to your email</span>
                        <span class="text-zh" style="display: none;">您的個人化洞察將發送到您的電子郵件</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assessment Form -->
        <main class="assessment-main">
            <form id="assessmentForm" class="assessment-form">
                <!-- Name Input Section -->
                <div class="name-input-section">
                    <div class="input-group">
                        <label for="studentName" class="input-label">
                            <span class="label-icon">👤</span>
                            <span class="text-en">Your Full Name</span>
                            <span class="text-zh" style="display: none;">您的真實姓名</span>
                            <span class="required-mark">*</span>
                        </label>
                        <input type="text" id="studentName" name="studentName" required 
                               class="name-input"
                               placeholder="Enter your full name / 請輸入您的真實姓名">
                    </div>
                    
                    <div class="input-group">
                        <label for="studentEmail" class="input-label">
                            <span class="label-icon">📧</span>
                            <span class="text-en">Your Email Address</span>
                            <span class="text-zh" style="display: none;">您的電子郵件地址</span>
                            <span class="required-mark">*</span>
                        </label>
                        <input type="email" id="studentEmail" name="studentEmail" required 
                               class="name-input"
                               placeholder="Enter your email / 請輸入您的電子郵件">
                    </div>
                </div>



                <!-- Questions Container -->
                <div id="questionsContainer" class="questions-container">
                    <!-- Questions will be populated by JavaScript -->
                </div>

                <!-- Submit Section -->
                <div class="submit-section">
                    <button type="submit" id="submitBtn" class="submit-button" disabled>
                        <span class="button-content">
                            <span class="button-icon">✨</span>
                            <span class="button-text">
                                <span class="text-en">Reveal My Authentic Self</span>
                                <span class="text-zh" style="display: none;">揭示真實的自我</span>
                            </span>
                        </span>
                        <div class="button-shine"></div>
                    </button>
                    
                    <p class="submit-note">
                        <span class="text-en">Your personalized insights will arrive in your inbox moments after completion</span>
                        <span class="text-zh" style="display: none;">您的個人化洞察將在完成後立即發送到您的收件箱</span>
                    </p>
                </div>
            </form>
        </main>

        <!-- Fixed Scale Reference -->
        <div class="scale-reference" id="scaleReference">
            <div class="scale-content">
                <div class="scale-title">
                    <span class="text-en">Quick Reference</span>
                    <span class="text-zh" style="display: none;">快速參考</span>
                </div>
                <div class="scale-items">
                    <span class="scale-quick-item">1 = <span class="text-en">Never</span><span class="text-zh" style="display: none;">從不</span></span>
                    <span class="scale-quick-item">3 = <span class="text-en">Sometimes</span><span class="text-zh" style="display: none;">有時</span></span>
                    <span class="scale-quick-item">5 = <span class="text-en">Always</span><span class="text-zh" style="display: none;">總是</span></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("I2KqoGsE81K29GmFC");

        // Language Toggle Functionality with inheritance from homepage
        function initializeLanguageToggle() {
            // Get language preference from sessionStorage (set by language selection)
            const savedLang = sessionStorage.getItem('selectedLanguage') || 'en';
            
            const langButtons = document.querySelectorAll('.lang-btn');
            const enElements = document.querySelectorAll('.text-en');
            const zhElements = document.querySelectorAll('.text-zh');
            
            // Apply saved language immediately
            if (savedLang === 'zh') {
                langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === 'zh'));
                enElements.forEach(el => el.style.display = 'none');
                zhElements.forEach(el => el.style.display = '');
                document.documentElement.lang = 'zh-TW';
                updatePlaceholders('zh');
            } else {
                langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === 'en'));
                enElements.forEach(el => el.style.display = '');
                zhElements.forEach(el => el.style.display = 'none');
                document.documentElement.lang = 'en';
                updatePlaceholders('en');
            }
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const lang = btn.dataset.lang;
                    
                    // Update button states
                    langButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Save language preference for current session
                    sessionStorage.setItem('selectedLanguage', lang);
                    
                    // Toggle language visibility
                    if (lang === 'en') {
                        enElements.forEach(el => el.style.display = '');
                        zhElements.forEach(el => el.style.display = 'none');
                        document.documentElement.lang = 'en';
                        updatePlaceholders('en');
                    } else {
                        enElements.forEach(el => el.style.display = 'none');
                        zhElements.forEach(el => el.style.display = '');
                        document.documentElement.lang = 'zh-TW';
                        updatePlaceholders('zh');
                    }
                    
                    // Regenerate questions in the new language
                    generateQuestions();
                });
            });
        }

        function updatePlaceholders(lang) {
            const nameInput = document.getElementById('studentName');
            const emailInput = document.getElementById('studentEmail');
            if (lang === 'en') {
                nameInput.placeholder = 'Enter your full name';
                emailInput.placeholder = 'Enter your email address';
            } else {
                nameInput.placeholder = '請輸入您的真實姓名';
                emailInput.placeholder = '請輸入您的電子郵件';
            }
        }

        // High-Quality Behavior Assessment Questions with Traditional Chinese Translations
        const questions = {
            en: [
                "I often worry about what others think of me.",
                "I frequently second-guess my decisions.",
                "I tend to avoid confrontation even when it's necessary.",
                "I often feel the need to prove myself to others.",
                "I have difficulty saying 'no' to requests.",
                "I worry excessively about making mistakes.",
                "I often feel responsible for other people's emotions.",
                "I tend to procrastinate on important tasks.",
                "I frequently compare myself to others.",
                "I often feel like I'm not good enough.",
                "I have trouble accepting compliments.",
                "I tend to catastrophize situations.",
                "I often feel overwhelmed by daily responsibilities.",
                "I have difficulty expressing my true feelings.",
                "I tend to put others' needs before my own.",
                "I often feel guilty when I take time for myself.",
                "I have trouble trusting my own judgment.",
                "I frequently feel anxious in social situations.",
                "I tend to avoid taking risks.",
                "I often feel like I need to be perfect.",
                "I have difficulty setting boundaries with others.",
                "I tend to overthink situations.",
                "I often feel like I'm disappointing others.",
                "I have trouble asking for help when I need it.",
                "I frequently feel stressed about things I cannot control.",
                "I tend to be overly critical of myself.",
                "I often feel like I'm not living up to my potential.",
                "I have difficulty making decisions without seeking approval.",
                "I tend to avoid difficult conversations.",
                "I often feel responsible for fixing other people's problems.",
                "I have trouble enjoying success because I worry about the future.",
                "I frequently feel like I'm pretending to be someone I'm not.",
                "I tend to minimize my own achievements.",
                "I often feel anxious when I'm not busy or productive.",
                "I have difficulty relaxing and enjoying the present moment.",
                "I tend to focus more on my failures than my successes.",
                "I often feel like I need external validation to feel worthy.",
                "I have trouble believing that I deserve good things.",
                "I frequently feel like I'm behind in life compared to others.",
                "I tend to sacrifice my own happiness for others.",
                "I often feel like I'm walking on eggshells around certain people.",
                "I have difficulty expressing anger or frustration appropriately.",
                "I tend to ruminate on past mistakes or embarrassing moments.",
                "I often feel like I need to justify my choices to others.",
                "I have trouble being vulnerable or opening up to others.",
                "I frequently feel like I'm not smart or capable enough.",
                "I tend to avoid situations where I might be judged.",
                "I often feel like I'm carrying the weight of the world.",
                "I have difficulty celebrating my accomplishments.",
                "I tend to expect the worst-case scenario in most situations.",
                "I often feel like I'm not deserving of love or respect.",
                "I have trouble maintaining my energy and motivation over time.",
                "I frequently feel like I need to hide my true self from others.",
                "I tend to feel guilty about past decisions or actions.",
                "I often feel like I'm not meeting others' expectations.",
                "I have difficulty trusting that things will work out okay.",
                "I tend to focus on what's wrong rather than what's right.",
                "I often feel like I'm not in control of my own life.",
                "I have trouble accepting that I can't please everyone.",
                "I frequently feel overwhelmed by the expectations I place on myself."
            ],
            zh: [
                "我常常擔心別人對我的看法",
                "我經常質疑自己的決定",
                "即使有必要，我也傾向避免衝突",
                "我常覺得需要向他人證明自己",
                "我難以拒絕別人的請求",
                "我過度擔心自己會犯錯",
                "我常為他人的情緒感到負責",
                "我常會拖延處理重要任務",
                "我經常拿自己和他人比較",
                "我常覺得自己不夠好",
                "我難以坦然接受讚美",
                "我容易把情況想得過度嚴重",
                "日常責任常讓我感到不堪重負",
                "我很難表達內心真實感受",
                "我傾向把他人需求放在自己之前",
                "為自己安排時間時，我常感到內疚",
                "我很難相信自己的判斷",
                "在社交場合我經常感到焦慮",
                "我傾向避免承擔風險",
                "我常覺得自己必須做到完美",
                "我難以設定明確的人際界線",
                "我容易過度分析各種情況",
                "我常覺得自己讓別人失望",
                "需要幫助時，我難以開口求助",
                "我常為無法控制的事情感到壓力",
                "我對自己過度嚴苛",
                "我常覺得自己沒發揮全部潛力",
                "做決定時，我需要他人認可",
                "我傾向迴避困難的對話",
                "我常覺得該負責解決別人的問題",
                "成功時，我因擔心未來而難以享受",
                "我常覺得自己在假裝成別人",
                "我傾向輕描淡寫自己的成就",
                "無所事事時，我常感到焦慮",
                "我難以放鬆享受當下時刻",
                "我更容易關注失敗而非成功",
                "我需要外在認可來感到有價值",
                "我難以相信自己值得擁有美好事物",
                "我常覺得自己的人生進度落後他人",
                "我傾向犧牲自己的快樂成全他人",
                "在某些人面前，我常覺得如履薄冰",
                "我難以適當表達憤怒或挫折",
                "我容易反芻過去的錯誤或尷尬",
                "我常覺得需要為自己的選擇辯護",
                "我難以在他人面前展現脆弱",
                "我常覺得自己不夠聰明能幹",
                "我傾向避免可能被評價的場合",
                "我常覺得肩負過重責任",
                "我難以真心為自己的成就開心",
                "我傾向預想最糟的情況",
                "我常覺得自己不配被愛或尊重",
                "我難以長期維持動力與精力",
                "我常隱藏真實的自我",
                "我容易對過去的決定感到懊悔",
                "我常覺得達不到他人的期望",
                "我難以相信事情會自然好轉",
                "我更容易關注問題而非優點",
                "我常覺得無法掌控自己的人生",
                "我難以接受無法讓所有人滿意",
                "我常因自我要求過高感到壓力"
            ]
        };

        // Progress Tracking
        let currentProgress = 0;
        const totalQuestions = 60;

        function updateProgress() {
            const progressNumber = document.getElementById('progressNumber');
            const progressRing = document.getElementById('progressRing');
            
            const percentage = Math.round((currentProgress / totalQuestions) * 100);
            
            // Update text
            progressNumber.textContent = currentProgress;
            
            // Update circular progress bar
            const circumference = 2 * Math.PI * 25; // radius is 25
            const offset = circumference - (percentage / 100) * circumference;
            progressRing.style.strokeDasharray = circumference;
            progressRing.style.strokeDashoffset = offset;
        }

        // Generate Questions
        function generateQuestions() {
            const container = document.getElementById('questionsContainer');
            const currentLang = document.querySelector('.lang-btn.active').dataset.lang;
            const questionSet = questions[currentLang];
            
            container.innerHTML = '';
            
            questionSet.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">${index + 1}</span>
                        <p class="question-text">${question}</p>
                    </div>
                    <div class="rating-slider-container">
                        <div class="slider-labels">
                            <span class="slider-label">${currentLang === 'en' ? 'Never' : '從不'}</span>
                            <span class="slider-label">${currentLang === 'en' ? 'Rarely' : '很少'}</span>
                            <span class="slider-label">${currentLang === 'en' ? 'Sometimes' : '有時'}</span>
                            <span class="slider-label">${currentLang === 'en' ? 'Often' : '經常'}</span>
                            <span class="slider-label">${currentLang === 'en' ? 'Always' : '總是'}</span>
                        </div>
                        <div class="slider-wrapper">
                            <input type="range" 
                                   class="rating-slider" 
                                   name="q${index}" 
                                   min="1" 
                                   max="5" 
                                   step="1" 
                                   required
                                   data-question="${index}"
                                   data-touched="false">
                            <div class="slider-dots">
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(questionDiv);
            });

            // Add event listeners for progress tracking
            const sliders = container.querySelectorAll('.rating-slider');
            sliders.forEach(slider => {
                slider.addEventListener('input', () => {
                    // Mark as touched when user interacts
                    slider.setAttribute('data-touched', 'true');
                    slider.classList.add('touched');
                    updateProgressFromAnswers();
                });
            });
        }

        function updateProgressFromAnswers() {
            const answeredQuestions = new Set();
            const sliders = document.querySelectorAll('#questionsContainer .rating-slider');
            
            sliders.forEach(slider => {
                // Only count if the user has actually touched the slider
                if (slider.getAttribute('data-touched') === 'true') {
                    answeredQuestions.add(slider.name);
                }
            });
            
            currentProgress = answeredQuestions.size;
            updateProgress();
            
            // Enable submit button when all questions are answered
            const submitBtn = document.getElementById('submitBtn');
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            
            if (currentProgress === totalQuestions && studentName && studentEmail) {
                submitBtn.disabled = false;
                submitBtn.classList.add('ready');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.remove('ready');
            }
        }

        // Form Submission
        document.getElementById('assessmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            const currentLang = document.querySelector('.lang-btn.active').dataset.lang;
            
            // Validate inputs
            if (!studentName) {
                alert(currentLang === 'en' ? 'Please enter your name.' : '請輸入您的姓名。');
                return;
            }
            
            if (!studentEmail) {
                alert(currentLang === 'en' ? 'Please enter your email address.' : '請輸入您的電子郵件地址。');
                return;
            }
            
            // Collect answers
            const answers = [];
            for (let i = 0; i < totalQuestions; i++) {
                const slider = document.querySelector(`input[name="q${i}"]`);
                if (slider && slider.getAttribute('data-touched') === 'true') {
                    answers.push(parseInt(slider.value));
                }
            }
            
            // Calculate behavioral pattern scores
            const typeScores = [0, 0, 0, 0, 0, 0]; // 6 personality types
            
            // Distribute questions among 6 types (10 questions each)
            for (let i = 0; i < totalQuestions; i++) {
                const typeIndex = Math.floor(i / 10);
                typeScores[typeIndex] += answers[i];
            }
            
            // Calculate percentages
            const typePercentages = typeScores.map(score => Math.round((score / 50) * 100));
            const totalScore = answers.reduce((sum, answer) => sum + answer, 0);
            
            // Determine dominant type
            const maxScore = Math.max(...typePercentages);
            const dominantTypeIndex = typePercentages.indexOf(maxScore);
            
            const typeNames = {
                en: ['Pleaser', 'Worrier', 'Prover', 'Critic', 'Avoider', 'Martyr'],
                zh: ['取悅者', '擔憂者', '證明者', '批評者', '迴避者', '殉道者']
            };
            
            const resultCategory = typeNames[currentLang][dominantTypeIndex];
            const resultDescription = currentLang === 'en' ? 
                `Your dominant behavioral pattern is ${resultCategory} with ${maxScore}% tendency. This indicates your primary psychological approach to challenges and relationships.` :
                `您的主要行為模式是${resultCategory}，傾向度為${maxScore}%。這顯示了您面對挑戰和人際關係的主要心理方式。`;
            
            // Prepare email content
            const emailContent = `
                Student Name: ${studentName}
                Assessment: Personality Behavior Pattern Assessment
                Completion Date: ${new Date().toLocaleString()}
                
                Results Summary:
                Total Score: ${totalScore}/${totalQuestions * 5}
                Dominant Type: ${resultCategory} (${maxScore}%)
                
                Type Breakdown:
                ${typeNames.en.map((name, index) => `${name}: ${typePercentages[index]}%`).join('\n')}
                
                Description: ${resultDescription}
                
                Individual Question Responses:
                ${answers.map((answer, index) => `Question ${index + 1}: ${answer}/5`).join('\n')}
            `;
            
            try {
                // Store results and redirect (skip email for now)
                sessionStorage.setItem('assessmentResults', JSON.stringify({
                    studentName,
                    testType: 'Personality Behavior Pattern Assessment',
                    totalScore,
                    resultCategory,
                    resultDescription,
                    typePercentages,
                    answers,
                    completionDate: new Date().toLocaleString()
                }));
                
                // Try to send email but don't block on failure
                try {
                    // Create type breakdown for personality assessment
                    const typeNames = currentLang === 'en' ? 
                        ['Pleaser', 'Worrier', 'Prover', 'Critic', 'Avoider', 'Martyr'] :
                        ['取悅者', '擔憂者', '證明者', '批評者', '迴避者', '殉道者'];
                    
                    const breakdownHtml = `
                        <div style="background-color: white; border-radius: 8px; padding: 16px; margin-top: 16px;">
                            <h5 style="margin: 0 0 12px 0; color: #667eea; font-size: 14px;">${currentLang === 'en' ? 'Personality Type Breakdown:' : '人格類型分析：'}</h5>
                            ${typePercentages.map((percentage, index) => {
                                const isTop = percentage === maxScore;
                                return `<div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 6px 12px; background-color: ${isTop ? '#f0f4ff' : '#f8f9fa'}; border-radius: 4px; ${isTop ? 'border-left: 3px solid #667eea;' : ''}">
                                    <span style="font-size: 13px; color: #555;">${typeNames[index]}${isTop ? ' ⭐' : ''}</span>
                                    <span style="font-weight: ${isTop ? 'bold' : 'normal'}; color: ${isTop ? '#667eea' : '#666'}; font-size: 13px;">${percentage}%</span>
                                </div>`;
                            }).join('')}
                        </div>
                    `;
                    
                    // Prepare multilingual email content
                    const emailData = {
                        student_name: studentName,
                        student_email: studentEmail || document.getElementById('studentEmail').value,
                        test_type: currentLang === 'en' ? "Personality Behavior Pattern Assessment" : "人格行為模式評估",
                        completion_date: new Date().toLocaleDateString(),
                        message: emailContent,
                        
                        // Header content
                        header_emoji: "🧠",
                        header_title: currentLang === 'en' ? "Personality Results" : "人格評估結果",
                        
                        // Greeting and messages
                        greeting: currentLang === 'en' ? "Hello" : "您好",
                        completion_message: currentLang === 'en' ? 
                            "Thank you for completing the Personality Behavior Pattern Assessment! Your detailed personality analysis is ready." :
                            "感謝您完成人格行為模式評估！您的詳細人格分析已準備好。",
                            
                        // Results section
                        results_title: currentLang === 'en' ? "Your Personality Profile" : "您的人格檔案",
                        main_score: `${maxScore}%`,
                        score_label: currentLang === 'en' ? "Dominant Pattern Strength" : "主要模式強度",
                        result_category: resultCategory,
                        result_description: resultDescription,
                        breakdown_section: breakdownHtml,
                        
                        // Insights
                        insights_title: currentLang === 'en' ? "Understanding Your Results" : "理解您的結果",
                        insights_text: currentLang === 'en' ? 
                            "Your personality profile reveals patterns in how you think, feel, and behave. Use these insights to understand your natural tendencies and identify opportunities for personal growth." :
                            "您的人格檔案揭示了您思考、感受和行為的模式。請利用這些洞察來了解您的自然傾向並識別個人成長的機會。",
                            
                        // Footer content
                        detailed_title: currentLang === 'en' ? "Complete Assessment Data" : "完整評估數據",
                        completion_date_label: currentLang === 'en' ? "Assessment completed on:" : "評估完成日期：",
                        questions_text: currentLang === 'en' ? "Questions about your results?" : "對結果有疑問？",
                        disclaimer_text: currentLang === 'en' ? 
                            "This personality assessment is designed for educational and self-development purposes. Results should be used as a guide for personal reflection and growth." :
                            "此人格評估用於教育和自我發展目的。結果應作為個人反思和成長的指南。",
                        footer_brand: currentLang === 'en' ? "Personality Assessment Team" : "人格評估測試團隊",
                        footer_subtitle: currentLang === 'en' ? "Professional Psychological Evaluation" : "專業心理評估"
                    };
                    
                    // Send to user
                    await emailjs.send("service_2mndbrx", "template_z0l98oa", emailData);
                    
                    // Send to admin (always in English for admin)
                    const adminEmailData = { ...emailData };
                    adminEmailData.student_email = "felicco@gmail.com";
                    adminEmailData.test_type = "Personality Behavior Pattern Assessment";
                    adminEmailData.header_title = "Personality Results";
                    adminEmailData.greeting = "Hello";
                    adminEmailData.completion_message = `${studentName} has completed the Personality Behavior Pattern Assessment. Results summary attached.`;
                    
                    await emailjs.send("service_2mndbrx", "template_z0l98oa", adminEmailData);
                    
                    console.log('Emails sent successfully');
                } catch (emailError) {
                    console.log('Email failed but continuing to results:', emailError);
                }
                
                window.location.href = 'results.html';
                
            } catch (error) {
                console.error('Error processing assessment:', error);
                alert(currentLang === 'en' ? 
                    'There was an error processing your results. Please try again.' :
                    '處理您的結果時發生錯誤，請重試。');
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeLanguageToggle();
            generateQuestions();
            updateProgress();
            
            // Add input listeners for real-time validation
            document.getElementById('studentName').addEventListener('input', updateProgressFromAnswers);
            document.getElementById('studentEmail').addEventListener('input', updateProgressFromAnswers);
        });
    </script>

    <!-- Floating Progress Indicator - positioned above scale reference -->
    <div id="progressIndicator" class="floating-progress floating-progress-stacked">
        <div class="progress-circle">
            <svg class="progress-ring" width="60" height="60">
                <circle class="progress-ring-background" cx="30" cy="30" r="25"></circle>
                <circle class="progress-ring-progress" cx="30" cy="30" r="25" id="progressRing"></circle>
            </svg>
            <div class="progress-text">
                <span id="progressNumber">0</span>
                <span class="progress-total">/60</span>
            </div>
        </div>
        <div class="progress-label-text">
            <span class="text-en">Progress</span>
            <span class="text-zh" style="display: none;">進度</span>
        </div>
    </div>
</body>
</html> 