<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Communication Style Assessment | 個人溝通風格評估</title>
    <meta name="description" content="Professional assessment to identify your primary communication patterns and behavioral tendencies in interpersonal interactions.">

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <link rel="stylesheet" href="../assets/css/behavior-assessment.css?v=2">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <div class="assessment-container">
        <!-- Navigation Header -->
        <nav class="nav-header">
            <a href="../index.html" class="logo">
                <span class="text-en">Explore Yourself</span>
                <span class="text-zh" style="display: none;">探索自我</span>
            </a>
            <div class="nav-meta">
                <div class="language-toggle">
                    <button class="lang-btn active" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="zh"TW</button>
                </div>
                <a href="../index.html" class="back-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="text-en">Back to Home</span>
                    <span class="text-zh" style="display: none;">回到首頁</span>
                </a>
            </div>
        </nav>

        <!-- Assessment Header -->
        <header class="assessment-header">
            <div class="header-content">
                <div class="assessment-icon">🧠</div>
                <h1 class="assessment-title">
                    <span class="text-en">Your Authentic Communication Style</span>
                    <span class="text-zh" style="display: none;">您真實的溝通風格</span>
                </h1>
                <p class="assessment-subtitle">
                    <span class="text-en">Discover how you naturally communicate and process information. Through 60 questions, you'll uncover your authentic communication style—how you absorb information, make decisions, and connect with others.</span>
                    <span class="text-zh" style="display: none;">發現你自然的溝通和資訊處理方式。透過 60 道題目，揭示你真實的溝通風格——你如何吸收資訊、做決定、與他人連結。</span>
                </p>
                
                <div class="assessment-info">
                    <div class="info-stat">
                        <span class="stat-number">60</span>
                        <span class="stat-label">
                            <span class="text-en">Questions</span>
                            <span class="text-zh" style="display: none;">題目</span>
                        </span>
                    </div>
                    <div class="info-stat">
                        <span class="stat-number">8-12</span>
                        <span class="stat-label">
                            <span class="text-en">Minutes</span>
                            <span class="text-zh" style="display: none;">分鐘</span>
                        </span>
                    </div>
                    <div class="info-stat">
                        <span class="stat-number">6</span>
                        <span class="stat-label">
                            <span class="text-en">Types</span>
                            <span class="text-zh" style="display: none;">類型</span>
                        </span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Instructions Panel -->
        <section class="instructions-panel">
            <div class="instructions-content">
                <h3 class="instructions-title">
                    <span class="text-en">Assessment Instructions</span>
                    <span class="text-zh" style="display: none;">評估說明</span>
                </h3>
                
                <div class="instructions-text">
                    <div class="text-en">
                        <p>This assessment identifies behavioral patterns that emerge when you're <strong>not at your best</strong> (stressed, upset, tired, etc.). Answer each question thinking about how you behave during challenging times, not your normal functioning. There are no right or wrong answers—respond honestly to get accurate results.</p>
                    </div>
                    <div class="text-zh" style="display: none;">
                        <p>此評估識別當您<strong>不在最佳狀態時</strong>（比如壓力大、心情不好、疲憊不堪等）出現的行為模式。請根據您在困難時期的行為方式回答每個問題，而不是正常狀態下的表現。沒有對錯答案——誠實回答以獲得準確結果。</p>
                    </div>
                </div>
                


                <div class="important-notes">
                    <div class="note-item">
                        <span class="note-icon">💡</span>
                        <span class="text-en">Trust your first instinct - it's usually the most authentic</span>
                        <span class="text-zh" style="display: none;">相信您的第一直覺，通常是最真實的</span>
                    </div>
                    <div class="note-item">
                        <span class="note-icon">🌈</span>
                        <span class="text-en">Every answer is valid - this is about discovering your unique style</span>
                        <span class="text-zh" style="display: none;">每個答案都是有效的，這是為了發現您獨特的風格</span>
                    </div>
                    <div class="note-item">
                        <span class="note-icon">🎁</span>
                        <span class="text-en">Your personalized insights will be delivered to your email</span>
                        <span class="text-zh" style="display: none;">您的個人化洞察將發送到您的電子郵件</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assessment Form -->
        <main class="assessment-main">
            <form id="assessmentForm" class="assessment-form">
                <!-- Name Input Section -->
                <div class="name-input-section">
                    <div class="input-group">
                        <label for="studentName" class="input-label">
                            <span class="label-icon">👤</span>
                            <span class="text-en">Your Full Name</span>
                            <span class="text-zh" style="display: none;">您的真實姓名</span>
                            <span class="required-mark">*</span>
                        </label>
                        <input type="text" id="studentName" name="studentName" required 
                               class="name-input"
                               placeholder="Enter your full name / 請輸入您的真實姓名">
                    </div>
                    
                    <div class="input-group">
                        <label for="studentEmail" class="input-label">
                            <span class="label-icon">📧</span>
                            <span class="text-en">Your Email Address</span>
                            <span class="text-zh" style="display: none;">您的電子郵件地址</span>
                            <span class="required-mark">*</span>
                        </label>
                        <input type="email" id="studentEmail" name="studentEmail" required 
                               class="name-input"
                               placeholder="Enter your email / 請輸入您的電子郵件">
                    </div>
                </div>



                <!-- Context Reminder -->
                <div class="context-reminder">
                    <div class="reminder-content">
                        <span class="reminder-icon">💭</span>
                        <span class="reminder-text">
                            <span class="text-en">Think about how you behave when you're <strong>not at your best</strong> (stressed, upset, tired, etc.)</span>
                            <span class="text-zh" style="display: none;">請思考當您<strong>不在最佳狀態時</strong>（比如壓力大、心情不好、疲憊不堪等）的行為表現</span>
                        </span>
                    </div>
                </div>

                <!-- Questions Container -->
                <div id="questionsContainer" class="questions-container">
                    <!-- Questions will be populated by JavaScript -->
                </div>

                <!-- Submit Section -->
                <div class="submit-section">
                    <button type="submit" id="submitBtn" class="submit-button" disabled>
                        <span class="button-content">
                            <span class="button-icon">✨</span>
                            <span class="button-text">
                                <span class="text-en">Reveal My Authentic Self</span>
                                <span class="text-zh" style="display: none;">揭示真實的自我</span>
                            </span>
                        </span>
                        <div class="button-shine"></div>
                    </button>
                    
                    <p class="submit-note">
                        <span class="text-en">Your personalized insights will arrive in your inbox moments after completion</span>
                        <span class="text-zh" style="display: none;">您的個人化洞察將在完成後立即發送到您的收件箱</span>
                    </p>
                </div>
            </form>
        </main>


    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("I2KqoGsE81K29GmFC");

        // Language Toggle Functionality with inheritance from homepage
        function initializeLanguageToggle() {
            // Get language preference from sessionStorage (set by language selection)
            const savedLang = sessionStorage.getItem('selectedLanguage') || 'en';
            
            const langButtons = document.querySelectorAll('.lang-btn');
            const enElements = document.querySelectorAll('.text-en');
            const zhElements = document.querySelectorAll('.text-zh');
            
            // Apply saved language immediately
            if (savedLang === 'zh') {
                langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === 'zh'));
                enElements.forEach(el => el.style.display = 'none');
                zhElements.forEach(el => el.style.display = '');
                document.documentElement.lang = 'zh-TW';
                updatePlaceholders('zh');
            } else {
                langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === 'en'));
                enElements.forEach(el => el.style.display = '');
                zhElements.forEach(el => el.style.display = 'none');
                document.documentElement.lang = 'en';
                updatePlaceholders('en');
            }
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const lang = btn.dataset.lang;
                    
                    // Update button states
                    langButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Save language preference for current session
                    sessionStorage.setItem('selectedLanguage', lang);
                    
                    // Toggle language visibility
                    if (lang === 'en') {
                        enElements.forEach(el => el.style.display = '');
                        zhElements.forEach(el => el.style.display = 'none');
                        document.documentElement.lang = 'en';
                        updatePlaceholders('en');
                    } else {
                        enElements.forEach(el => el.style.display = 'none');
                        zhElements.forEach(el => el.style.display = '');
                        document.documentElement.lang = 'zh-TW';
                        updatePlaceholders('zh');
                    }
                    
                    // Regenerate questions in the new language
                    generateQuestions();
                });
            });
        }

        function updatePlaceholders(lang) {
            const nameInput = document.getElementById('studentName');
            const emailInput = document.getElementById('studentEmail');
            if (lang === 'en') {
                nameInput.placeholder = 'Enter your full name';
                emailInput.placeholder = 'Enter your email address';
            } else {
                nameInput.placeholder = '請輸入您的真實姓名';
                emailInput.placeholder = '請輸入您的電子郵件';
            }
        }

        // High-Quality Behavior Assessment Questions with Traditional Chinese Translations
        const questions = {
            en: [
                // Pleaser
                "Do you find yourself being overly flexible and accommodating to others' schedules and needs?",
                "Do you find yourself overthinking how your opinion might affect others' feelings before sharing it?",
                "Do you find yourself working extra hard to find common ground and express ideas in ways that please everyone?",
                "Do you find yourself feeling anxious if you can't create a positive and harmonious environment for everyone?",
                "Do you find yourself quickly reconsidering your views when faced with different perspectives from the group?",
                "Do you find yourself saying yes to help even when you're already overwhelmed?",
                "Do you find yourself listening more than speaking to avoid any potential conflict?",
                "Do you find yourself carefully choosing words to ensure your message won't upset anyone?",
                "Do you find yourself quickly taking responsibility to resolve misunderstandings even when they're not your fault?",
                "Do you find yourself prioritizing the group's happiness over your own needs?",
                // Worrier
                "Do you find yourself becoming overly focused on identifying potential risks and planning for every contingency?",
                "Do you find yourself getting stuck in analysis paralysis, thinking through all potential outcomes?",
                "Do you find yourself feeling anxious when you don't have a clear plan or don't know what to expect?",
                "Do you find yourself taking much longer to make decisions because you're weighing every possible pro and con?",
                "Do you find yourself obsessing over details and potential errors that others might miss?",
                "Do you find yourself insisting on extensive risk assessment even for simple decisions?",
                "Do you find yourself struggling to perform in uncertain environments where processes aren't well-defined?",
                "Do you find yourself constantly worrying about future challenges and over-preparing for them?",
                "Do you find yourself refusing to start new projects until you have an overly comprehensive plan?",
                "Do you find yourself trying to prepare for every possible situation, even unlikely ones?",
                // Prover
                "Do you find yourself desperately seeking new challenges to prove your worth?",
                "Do you find yourself feeling anxious if you're not constantly delivering results efficiently?",
                "Do you find yourself pushing yourself harder to maintain high performance as a way to feel valuable?",
                "Do you find yourself insisting on handling difficult situations alone to prove your competence?",
                "Do you find yourself immediately jumping to the next goal without celebrating achievements?",
                "Do you find yourself setting unrealistically high standards to prove you can go the extra mile?",
                "Do you find yourself becoming overly concerned about how others perceive your competence?",
                "Do you find yourself focusing obsessively on tangible results and achievements to feel worthy?",
                "Do you find yourself frantically trying to develop more skills to prove your effectiveness?",
                "Do you find yourself struggling alone with problems rather than asking for help?",
                // Critic
                "Do you find yourself setting impossibly high benchmarks for quality in your work?",
                "Do you find yourself becoming obsessed with refining and improving things until they're perfect?",
                "Do you find yourself constantly spotting problems and flaws that others miss?",
                "Do you find yourself unable to celebrate success because you're focused on what could be improved?",
                "Do you find yourself being overly harsh about errors and mistakes?",
                "Do you find yourself giving critical feedback instead of acknowledging what's working well?",
                "Do you find yourself obsessing over the smallest details that others consider unimportant?",
                "Do you find yourself becoming rigid about what is 'right' and what needs to be done?",
                "Do you find yourself constantly thinking about how to elevate performance instead of appreciating current success?",
                "Do you find yourself feeling dissatisfied and critical when things are just 'good enough'?",
                // Avoider
                "Do you find yourself procrastinating until deadlines create pressure to act?",
                "Do you find yourself hoping problems will resolve themselves rather than addressing them directly?",
                "Do you find yourself endlessly gathering information to avoid making difficult decisions?",
                "Do you find yourself focusing only on small, manageable tasks while avoiding complex situations?",
                "Do you find yourself talking about challenges without taking action to address them?",
                "Do you find yourself waiting for the 'perfect' opportunity rather than taking available actions?",
                "Do you find yourself deferring leadership to others even when you should step up?",
                "Do you find yourself avoiding necessary debates to maintain harmony?",
                "Do you find yourself blaming external factors instead of taking responsibility?",
                "Do you find yourself choosing familiar, safe paths even when they're not optimal?",
                // Martyr
                "Do you find yourself compulsively putting others' needs first even when you're depleted?",
                "Do you find yourself refusing help and insisting on handling everything yourself?",
                "Do you find yourself automatically taking on difficult tasks that others avoid?",
                "Do you find yourself believing you don't deserve rewards or personal time?",
                "Do you find yourself feeling resentful that your efforts aren't fully appreciated?",
                "Do you find yourself giving everything to projects or people without expecting anything back?",
                "Do you find yourself being generous with your time and energy even when you have nothing left to give?",
                "Do you find yourself feeling guilty if you're not taking care of everyone around you?",
                "Do you find yourself helping others to the point of personal exhaustion?",
                "Do you find yourself believing that self-sacrifice is the most noble way to live?"
            ],
            zh: [
                // Pleaser - 取悅者
                "你是否發現自己會過度靈活配合他人的時程和需求？",
                "你是否發現自己在分享意見前會過度思考對他人感受的影響？",
                "你是否發現自己會格外努力尋找共同點並以討好所有人的方式表達想法？",
                "你是否發現自己如果無法為大家創造正面和諧的環境就會感到焦慮？",
                "你是否發現自己面對團隊不同觀點時會快速重新考慮自己的看法？",
                "你是否發現自己即使已經不堪負荷還是會答應幫忙？",
                "你是否發現自己會聽得多說得少以避免任何潛在衝突？",
                "你是否發現自己會謹慎選詞以確保不會惹惱任何人？",
                "你是否發現自己會快速承擔責任化解誤會，即使不是你的錯？",
                "你是否發現自己會優先考慮團隊快樂而犧牲自己的需求？",
                // Worrier - 擔憂者
                "你是否發現自己會過度專注於識別潛在風險並為每個意外情況制定計畫？",
                "你是否發現自己會陷入分析癱瘓，思考所有可能的結果？",
                "你是否發現自己沒有明確計畫或不知道會發生什麼時會感到焦慮？",
                "你是否發現自己因為權衡每個可能的利弊而花費過長時間做決定？",
                "你是否發現自己會沉迷於細節和別人可能忽略的潛在錯誤？",
                "你是否發現自己即使對簡單決策也堅持進行廣泛的風險評估？",
                "你是否發現自己在流程不明確的不確定環境中難以表現？",
                "你是否發現自己會持續擔心未來挑戰並過度準備？",
                "你是否發現自己除非有過度周全的計畫否則拒絕開始新專案？",
                "你是否發現自己會試圖為每種可能情況做準備，即使是不太可能發生的？",
                // Prover - 證明者
                "你是否發現自己會拼命尋求新挑戰來證明自己的價值？",
                "你是否發現自己如果沒有持續高效交付成果就會感到焦慮？",
                "你是否發現自己會更加努力維持高績效作為感受價值的方式？",
                "你是否發現自己會堅持獨自處理困難情況來證明自己的能力？",
                "你是否發現自己會立刻跳到下個目標而不慶祝成就？",
                "你是否發現自己會設定不切實際的高標準來證明自己能做到最好？",
                "你是否發現自己會過度在意他人如何看待你的能力？",
                "你是否發現自己會沉迷於具體成果和成就來感受自我價值？",
                "你是否發現自己會瘋狂地嘗試發展更多技能來證明自己的效能？",
                "你是否發現自己會獨自掙扎解決問題而不尋求幫助？",
                // Critic - 批評者
                "你是否發現自己會為工作設定不可能達到的高品質標準？",
                "你是否發現自己會沉迷於改進事物直到完美？",
                "你是否發現自己會不斷發現別人遺漏的問題和缺陷？",
                "你是否發現自己無法慶祝成功因為專注於可以改進的地方？",
                "你是否發現自己對錯誤和失誤過於嚴厲？",
                "你是否發現自己會給出批評反饋而不承認運作良好的部分？",
                "你是否發現自己會沉迷於別人認為不重要的最小細節？",
                "你是否發現自己對什麼是「正確的」和需要完成的事變得僵化？",
                "你是否發現自己會不斷思考如何提升績效而不欣賞當前的成功？",
                "你是否發現自己對「夠好」的事物感到不滿和批評？",
                // Avoider - 迴避者
                "你是否發現自己會拖延直到截止日期產生壓力才行動？",
                "你是否發現自己會希望問題自行解決而不直接處理？",
                "你是否發現自己會無止境地收集資訊來避免做困難決定？",
                "你是否發現自己只專注於小的、可管理的任務而避免複雜情況？",
                "你是否發現自己會談論挑戰而不採取行動解決？",
                "你是否發現自己會等待「完美」機會而不採取現有行動？",
                "你是否發現自己即使應該挺身而出也會把領導權交給別人？",
                "你是否發現自己會為了維持和諧而避免必要的辯論？",
                "你是否發現自己會歸咎於外在因素而不承擔責任？",
                "你是否發現自己會選擇熟悉、安全的路徑即使不是最佳選擇？",
                // Martyr - 殉道者
                "你是否發現自己即使已經精疲力竭還是會強迫性地把他人需求放在第一位？",
                "你是否發現自己會拒絕幫助並堅持自己處理所有事情？",
                "你是否發現自己會自動承擔別人避免的困難任務？",
                "你是否發現自己會相信自己不值得獲得獎勵或個人時間？",
                "你是否發現自己會怨恨努力沒有得到充分賞識？",
                "你是否發現自己會為專案或人付出一切而不期望任何回報？",
                "你是否發現自己即使什麼都沒有了還是會慷慨付出時間和精力？",
                "你是否發現自己如果沒有照顧周圍的每個人就會感到內疚？",
                "你是否發現自己會幫助他人到個人精疲力竭的程度？",
                "你是否發現自己會相信自我犧牲是最高尚的生活方式？"
            ]
        };

        // Progress Tracking
        let currentProgress = 0;
        const totalQuestions = 60;

        // Create and shuffle the question order
        const randomizedOrder = Array.from({ length: totalQuestions }, (_, i) => i);
        // Fisher-Yates shuffle algorithm
        for (let i = randomizedOrder.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [randomizedOrder[i], randomizedOrder[j]] = [randomizedOrder[j], randomizedOrder[i]];
        }

        function updateProgress() {
            const progressNumber = document.getElementById('progressNumber');
            const progressBarFill = document.getElementById('progressBarFill');
            
            const percentage = Math.round((currentProgress / totalQuestions) * 100);
            
            // Update text
            progressNumber.textContent = currentProgress;
            
            // Update progress bar
            progressBarFill.style.width = `${percentage}%`;
        }

        // Generate Questions
        function generateQuestions() {
            const container = document.getElementById('questionsContainer');
            const currentLang = document.querySelector('.lang-btn.active').dataset.lang;
            const questionSet = questions[currentLang];
            
            container.innerHTML = '';
            
            randomizedOrder.forEach((originalIndex, i) => {
                const question = questionSet[originalIndex];
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.dataset.originalIndex = originalIndex; // Store original index

                const labels = currentLang === 'en' ? 
                    ['Never', 'Rarely', 'Sometimes', 'Often', 'Always'] :
                    ['從不', '很少', '有時', '經常', '總是'];

                questionDiv.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">${i + 1}</span>
                        <p class="question-text">${question}</p>
                    </div>
                    <div class="rating-container">
                        <div class="rating-options">
                            ${labels.map((label, value) => `
                                <div class="rating-option">
                                    <input type="radio" 
                                           id="q${i}_${value + 1}" 
                                           name="q${i}" 
                                           value="${value + 1}" 
                                           required
                                           data-question="${i}">
                                    <label for="q${i}_${value + 1}" class="rating-label">
                                        <span class="rating-number">${value + 1}</span>
                                        <span class="rating-text">${label}</span>
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(questionDiv);
            });

            // Add event listeners for progress tracking
            const radioButtons = container.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', () => {
                    updateProgressFromAnswers();
                });
            });
        }

        function updateProgressFromAnswers() {
            const answeredQuestions = new Set();
            
            // Count answered questions by checking if any radio button is selected for each question
            for (let i = 0; i < totalQuestions; i++) {
                const questionRadios = document.querySelectorAll(`input[name="q${i}"]`);
                const isAnswered = Array.from(questionRadios).some(radio => radio.checked);
                if (isAnswered) {
                    answeredQuestions.add(`q${i}`);
                }
            }
            
            currentProgress = answeredQuestions.size;
            updateProgress();
            
            // Enable submit button when all questions are answered
            const submitBtn = document.getElementById('submitBtn');
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            
            if (currentProgress === totalQuestions && studentName && studentEmail) {
                submitBtn.disabled = false;
                submitBtn.classList.add('ready');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.remove('ready');
            }
        }

        // Form Submission
        document.getElementById('assessmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            const currentLang = document.querySelector('.lang-btn.active').dataset.lang;
            
            // Validate inputs
            if (!studentName) {
                alert(currentLang === 'en' ? 'Please enter your name.' : '請輸入您的姓名。');
                return;
            }
            
            if (!studentEmail) {
                alert(currentLang === 'en' ? 'Please enter your email address.' : '請輸入您的電子郵件地址。');
                return;
            }
            
            // Collect answers
            const answers = [];
            const typeScores = [0, 0, 0, 0, 0, 0]; // 6 personality types
            
            const questionItems = document.querySelectorAll('.question-item');
            questionItems.forEach((q_item, i) => {
                const selectedRadio = q_item.querySelector(`input[name="q${i}"]:checked`);
                if (selectedRadio) {
                    const answerValue = parseInt(selectedRadio.value);
                    answers.push(answerValue); // Store answer in display order

                    const originalIndex = parseInt(q_item.dataset.originalIndex);
                    const typeIndex = Math.floor(originalIndex / 10);
                    typeScores[typeIndex] += answerValue;
                }
            });
            
            // Calculate percentages
            const typePercentages = typeScores.map(score => Math.round((score / 50) * 100));
            const totalScore = answers.reduce((sum, answer) => sum + answer, 0);
            
            // Determine dominant type
            const maxScore = Math.max(...typePercentages);
            const dominantTypeIndex = typePercentages.indexOf(maxScore);
            
            const typeNames = {
                en: ['Pleaser', 'Worrier', 'Prover', 'Critic', 'Avoider', 'Martyr'],
                zh: ['取悅者', '擔憂者', '證明者', '批評者', '迴避者', '殉道者']
            };
            
            // Enhanced type descriptions matching results.js structure
            const typeDescriptions = {
                0: { // Pleaser
                    fear_en: "not being liked or accepted",
                    fear_zh: "不被喜歡或接納",
                    motivation_en: "seeking approval and acceptance through pleasing others",
                    motivation_zh: "透過討好他人來獲得認可和接納",
                    bestState_en: "empathetic team player with strong collaborative abilities",
                    bestState_zh: "善解人意、團隊協作能力強",
                    guidance_en: "practice expressing authentic thoughts and building inner confidence",
                    guidance_zh: "練習表達真實想法，建立內在自信"
                },
                1: { // Worrier
                    fear_en: "uncertainty and unpredictability",
                    fear_zh: "不確定性和不可預測性",
                    motivation_en: "controlling risk through over-analysis and excessive preparation",
                    motivation_zh: "透過過度分析和準備來控制風險",
                    bestState_en: "thoughtful planner with strong risk assessment skills",
                    bestState_zh: "謹慎思考、風險評估能力強",
                    guidance_en: "learn to embrace uncertainty and develop action-oriented confidence",
                    guidance_zh: "學習接受不確定性，培養行動導向的自信"
                },
                2: { // Prover
                    fear_en: "being seen as incompetent or inadequate",
                    fear_zh: "被視為無能或不足",
                    motivation_en: "building self-worth through achievements and performance",
                    motivation_zh: "透過成就和表現來建立自我價值",
                    bestState_en: "goal-oriented achiever with strong execution abilities",
                    bestState_zh: "目標導向、執行力強的成就者",
                    guidance_en: "learn to accept help and value process over pure results",
                    guidance_zh: "學習接受幫助，重視過程而非只看結果"
                },
                3: { // Critic
                    fear_en: "imperfection and making mistakes",
                    fear_zh: "不完美和犯錯",
                    motivation_en: "avoiding errors and failure through high standards",
                    motivation_zh: "透過高標準來避免錯誤和失敗",
                    bestState_en: "detail-oriented perfectionist with high quality standards",
                    bestState_zh: "注重細節、品質意識高的完美主義者",
                    guidance_en: "learn to accept 'good enough' standards and practice self-acceptance",
                    guidance_zh: "學習接受'夠好'的標準，培養自我接納"
                },
                4: { // Avoider
                    fear_en: "conflict and potential failure",
                    fear_zh: "衝突和潛在失敗",
                    motivation_en: "avoiding discomfort and responsibility through withdrawal",
                    motivation_zh: "透過逃避來避免不適和責任",
                    bestState_en: "harmony-seeking peacemaker who avoids unnecessary conflict",
                    bestState_zh: "追求和諧、避免不必要衝突的和事佬",
                    guidance_en: "break problems into manageable steps and build success experiences",
                    guidance_zh: "將問題分解為可管理的步驟，建立成功經驗"
                },
                5: { // Martyr
                    fear_en: "being selfish or self-centered",
                    fear_zh: "自私或以自我為中心",
                    motivation_en: "gaining moral superiority through self-sacrifice",
                    motivation_zh: "透過犧牲自己來獲得道德優越感",
                    bestState_en: "helpful and responsible with strong service orientation",
                    bestState_zh: "樂於助人、責任感強，具有強烈的服務導向",
                    guidance_en: "learn to set healthy boundaries and balance giving with receiving",
                    guidance_zh: "學習設定健康界限，平衡付出與接受"
                }
            };

            const resultCategory = typeNames[currentLang][dominantTypeIndex];
            const typeDesc = typeDescriptions[dominantTypeIndex];
            
            const resultDescription = currentLang === 'en' ? 
                `Your dominant behavioral pattern is ${resultCategory} with ${maxScore}% tendency. This pattern is driven by a core fear of ${typeDesc.fear_en}, leading to ${typeDesc.motivation_en}. At your best, you are ${typeDesc.bestState_en}. For growth, focus on: ${typeDesc.guidance_en}` :
                `您的主要行為模式是${resultCategory}，傾向度為${maxScore}%。此模式源於對${typeDesc.fear_zh}的核心恐懼，導致${typeDesc.motivation_zh}。在最佳狀態下，您是${typeDesc.bestState_zh}。成長建議：${typeDesc.guidance_zh}`;
            
            // Prepare email content
            const emailContent = `
                Student Name: ${studentName}
                Assessment: Personality Behavior Pattern
                Completion Date: ${new Date().toLocaleString()}
                
                Results Summary:
                Dominant Type: ${resultCategory} (${maxScore}%)
                
                Type Breakdown:
                ${typeNames.en.map((name, index) => `${name}: ${typePercentages[index]}%`).join('\n')}
                
                Description: ${resultDescription}
                
                Individual Question Responses:
                ${answers.map((answer, index) => `Question ${index + 1}: ${answer}/5`).join('\n')}
            `;
            
            try {
                // Store results and redirect (skip email for now)
                sessionStorage.setItem('assessmentResults', JSON.stringify({
                    studentName,
                    testType: 'Personality Behavior Pattern Assessment',
                    totalScore,
                    resultCategory,
                    resultDescription,
                    typePercentages,
                    answers,
                    completionDate: new Date().toLocaleString()
                }));
                
                // Try to send email but don't block on failure
                try {
                    // Create type breakdown for personality assessment
                    const typeNames = currentLang === 'en' ? 
                        ['Pleaser', 'Worrier', 'Prover', 'Critic', 'Avoider', 'Martyr'] :
                        ['取悅者', '擔憂者', '證明者', '批評者', '迴避者', '殉道者'];
                    
                    const breakdownHtml = `
                        <div style="background-color: white; border-radius: 8px; padding: 16px; margin-top: 16px;">
                            <h5 style="margin: 0 0 12px 0; color: #667eea; font-size: 14px;">${currentLang === 'en' ? 'Personality Type Breakdown:' : '人格類型分析：'}</h5>
                            ${typePercentages.map((percentage, index) => {
                                const isTop = percentage === maxScore;
                                return `<div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 6px 12px; background-color: ${isTop ? '#f0f4ff' : '#f8f9fa'}; border-radius: 4px; ${isTop ? 'border-left: 3px solid #667eea;' : ''}">
                                    <span style="font-size: 13px; color: #555;">${typeNames[index]}${isTop ? ' ⭐' : ''}</span>
                                    <span style="font-weight: ${isTop ? 'bold' : 'normal'}; color: ${isTop ? '#667eea' : '#666'}; font-size: 13px;">${percentage}%</span>
                                </div>`;
                            }).join('')}
                        </div>
                    `;
                    
                    // Prepare multilingual email content
                    const emailData = {
                        student_name: studentName,
                        student_email: studentEmail || document.getElementById('studentEmail').value,
                        test_type: currentLang === 'en' ? "Personality Behavior Pattern Assessment" : "人格行為模式評估",
                        completion_date: new Date().toLocaleDateString(),
                        message: emailContent,
                        
                        // Header content
                        header_emoji: "🧠",
                        header_title: currentLang === 'en' ? "Personality Results" : "人格評估結果",
                        
                        // Greeting and messages
                        greeting: currentLang === 'en' ? "Hello" : "您好",
                        completion_message: currentLang === 'en' ? 
                            "Thank you for completing the Personality Behavior Pattern Assessment! Your detailed personality analysis is ready." :
                            "感謝您完成人格行為模式評估！您的詳細人格分析已準備好。",
                            
                        // Results section
                        results_title: currentLang === 'en' ? "Your Personality Profile" : "您的人格檔案",
                        main_score: `${maxScore}%`,
                        score_label: currentLang === 'en' ? "Dominant Pattern Strength" : "主要模式強度",
                        result_category: resultCategory,
                        result_description: resultDescription,
                        breakdown_section: breakdownHtml,
                        
                        // Insights
                        insights_title: currentLang === 'en' ? "Understanding Your Results" : "理解您的結果",
                        insights_text: currentLang === 'en' ? 
                            "Your personality profile reveals patterns in how you think, feel, and behave. Use these insights to understand your natural tendencies and identify opportunities for personal growth." :
                            "您的人格檔案揭示了您思考、感受和行為的模式。請利用這些洞察來了解您的自然傾向並識別個人成長的機會。",
                            
                        // Footer content
                        detailed_title: currentLang === 'en' ? "Complete Assessment Data" : "完整評估數據",
                        completion_date_label: currentLang === 'en' ? "Assessment completed on:" : "評估完成日期：",
                        questions_text: currentLang === 'en' ? "Questions about your results?" : "對結果有疑問？",
                        disclaimer_text: currentLang === 'en' ? 
                            "This personality assessment is designed for educational and self-development purposes. Results should be used as a guide for personal reflection and growth." :
                            "此評估用於教育和自我發展目的。結果應作為個人反思和成長的指南。",
                        footer_brand: currentLang === 'en' ? "Digitas Taiwan" : "Digitas 團隊",
                        footer_subtitle: currentLang === 'en' ? "Personal Evaluation" : "個人評估"
                    };
                    
                    // Send to user
                    await emailjs.send("service_2mndbrx", "template_z0l98oa", emailData);
                    
                    // Send to admin (always in English for admin)
                    const adminEmailData = { ...emailData };
                    adminEmailData.student_email = "felicco@gmail.com";
                    adminEmailData.test_type = "Personality Behavior Pattern Assessment";
                    adminEmailData.header_title = "Personality Results";
                    adminEmailData.greeting = "Hello";
                    adminEmailData.completion_message = `${studentName} has completed the Personality Behavior Pattern Assessment. Results summary attached.`;
                    
                    await emailjs.send("service_2mndbrx", "template_z0l98oa", adminEmailData);
                    
                    console.log('Emails sent successfully');
                } catch (emailError) {
                    console.log('Email failed but continuing to results:', emailError);
                }
                
                window.location.href = 'results.html';
                
            } catch (error) {
                console.error('Error processing assessment:', error);
                alert(currentLang === 'en' ? 
                    'There was an error processing your results. Please try again.' :
                    '處理您的結果時發生錯誤，請重試。');
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeLanguageToggle();
            generateQuestions();
            updateProgress();
            
            // Add input listeners for real-time validation
            document.getElementById('studentName').addEventListener('input', updateProgressFromAnswers);
            document.getElementById('studentEmail').addEventListener('input', updateProgressFromAnswers);
        });
    </script>

    <!-- Bottom Progress Status Bar -->
    <div id="progressIndicator" class="floating-progress floating-progress-stacked">
        <div class="progress-info">
            <span class="progress-label">
                <span class="text-en">Progress:</span>
                <span class="text-zh" style="display: none;">進度：</span>
            </span>
            <span class="progress-count">
                <span id="progressNumber">0</span>
                <span class="progress-total">/60</span>
            </span>
        </div>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progressBarFill"></div>
        </div>
    </div>
</body>
</html> 