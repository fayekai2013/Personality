<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Communication Style Assessment | 個人溝通風格評估</title>
    <meta name="description" content="Professional assessment to identify your primary communication patterns and behavioral tendencies in interpersonal interactions.">

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <link rel="stylesheet" href="../assets/css/behavior-assessment.css?v=2">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <div class="assessment-container">
        <!-- Navigation Header -->
        <nav class="nav-header">
            <a href="../index.html" class="logo">
                <span class="text-en">Explore Yourself</span>
                <span class="text-zh" style="display: none;">探索自我</span>
            </a>
            <div class="nav-meta">
                <div class="language-toggle">
                    <button class="lang-btn active" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="zh">中文</button>
                </div>
                <a href="../index.html" class="back-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="text-en">Back to Home</span>
                    <span class="text-zh" style="display: none;">回到首頁</span>
                </a>
            </div>
        </nav>

        <!-- Assessment Header -->
        <header class="assessment-header">
            <div class="header-content">
                <div class="assessment-icon">🧠</div>
                <h1 class="assessment-title">
                    <span class="text-en">Your Authentic Communication Style</span>
                    <span class="text-zh" style="display: none;">您真實的溝通風格</span>
                </h1>
                <p class="assessment-subtitle">
                    <span class="text-en">Discover how you naturally communicate and process information. Through 60 questions, you'll uncover your authentic communication style—how you absorb information, make decisions, and connect with others.</span>
                    <span class="text-zh" style="display: none;">發現你自然的溝通和資訊處理方式。透過 60 道題目，揭示你真實的溝通風格——你如何吸收資訊、做決定、與他人連結。</span>
                </p>
                
                <div class="assessment-info">
                    <div class="info-stat">
                        <span class="stat-number">60</span>
                        <span class="stat-label">
                            <span class="text-en">Questions</span>
                            <span class="text-zh" style="display: none;">題目</span>
                        </span>
                    </div>
                    <div class="info-stat">
                        <span class="stat-number">8-12</span>
                        <span class="stat-label">
                            <span class="text-en">Minutes</span>
                            <span class="text-zh" style="display: none;">分鐘</span>
                        </span>
                    </div>
                    <div class="info-stat">
                        <span class="stat-number">6</span>
                        <span class="stat-label">
                            <span class="text-en">Types</span>
                            <span class="text-zh" style="display: none;">類型</span>
                        </span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Instructions Panel -->
        <section class="instructions-panel">
            <div class="instructions-content">
                <h3 class="instructions-title">
                    <span class="text-en">Assessment Instructions</span>
                    <span class="text-zh" style="display: none;">評估說明</span>
                </h3>
                
                <div class="instructions-text">
                    <div class="text-en">
                        <p>This assessment evaluates your natural communication patterns and information processing style. Answer each question based on how you typically behave and think. There are no right or wrong answers—respond honestly to get accurate results.</p>
                    </div>
                    <div class="text-zh" style="display: none;">
                        <p>此評估評估您自然的溝通模式和資訊處理風格。請根據您通常的行為和思考方式回答每個問題。沒有對錯答案——誠實回答以獲得準確結果。</p>
                    </div>
                </div>
                


                <div class="important-notes">
                    <div class="note-item">
                        <span class="note-icon">💡</span>
                        <span class="text-en">Trust your first instinct - it's usually the most authentic</span>
                        <span class="text-zh" style="display: none;">相信您的第一直覺，通常是最真實的</span>
                    </div>
                    <div class="note-item">
                        <span class="note-icon">🌈</span>
                        <span class="text-en">Every answer is valid - this is about discovering your unique style</span>
                        <span class="text-zh" style="display: none;">每個答案都是有效的，這是為了發現您獨特的風格</span>
                    </div>
                    <div class="note-item">
                        <span class="note-icon">🎁</span>
                        <span class="text-en">Your personalized insights will be delivered to your email</span>
                        <span class="text-zh" style="display: none;">您的個人化洞察將發送到您的電子郵件</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assessment Form -->
        <main class="assessment-main">
            <form id="assessmentForm" class="assessment-form">
                <!-- Name Input Section -->
                <div class="name-input-section">
                    <div class="input-group">
                        <label for="studentName" class="input-label">
                            <span class="label-icon">👤</span>
                            <span class="text-en">Your Full Name</span>
                            <span class="text-zh" style="display: none;">您的真實姓名</span>
                            <span class="required-mark">*</span>
                        </label>
                        <input type="text" id="studentName" name="studentName" required 
                               class="name-input"
                               placeholder="Enter your full name / 請輸入您的真實姓名">
                    </div>
                    
                    <div class="input-group">
                        <label for="studentEmail" class="input-label">
                            <span class="label-icon">📧</span>
                            <span class="text-en">Your Email Address</span>
                            <span class="text-zh" style="display: none;">您的電子郵件地址</span>
                            <span class="required-mark">*</span>
                        </label>
                        <input type="email" id="studentEmail" name="studentEmail" required 
                               class="name-input"
                               placeholder="Enter your email / 請輸入您的電子郵件">
                    </div>
                </div>



                <!-- Questions Container -->
                <div id="questionsContainer" class="questions-container">
                    <!-- Questions will be populated by JavaScript -->
                </div>

                <!-- Submit Section -->
                <div class="submit-section">
                    <button type="submit" id="submitBtn" class="submit-button" disabled>
                        <span class="button-content">
                            <span class="button-icon">✨</span>
                            <span class="button-text">
                                <span class="text-en">Reveal My Authentic Self</span>
                                <span class="text-zh" style="display: none;">揭示真實的自我</span>
                            </span>
                        </span>
                        <div class="button-shine"></div>
                    </button>
                    
                    <p class="submit-note">
                        <span class="text-en">Your personalized insights will arrive in your inbox moments after completion</span>
                        <span class="text-zh" style="display: none;">您的個人化洞察將在完成後立即發送到您的收件箱</span>
                    </p>
                </div>
            </form>
        </main>


    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("I2KqoGsE81K29GmFC");

        // Language Toggle Functionality with inheritance from homepage
        function initializeLanguageToggle() {
            // Get language preference from sessionStorage (set by language selection)
            const savedLang = sessionStorage.getItem('selectedLanguage') || 'en';
            
            const langButtons = document.querySelectorAll('.lang-btn');
            const enElements = document.querySelectorAll('.text-en');
            const zhElements = document.querySelectorAll('.text-zh');
            
            // Apply saved language immediately
            if (savedLang === 'zh') {
                langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === 'zh'));
                enElements.forEach(el => el.style.display = 'none');
                zhElements.forEach(el => el.style.display = '');
                document.documentElement.lang = 'zh-TW';
                updatePlaceholders('zh');
            } else {
                langButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.lang === 'en'));
                enElements.forEach(el => el.style.display = '');
                zhElements.forEach(el => el.style.display = 'none');
                document.documentElement.lang = 'en';
                updatePlaceholders('en');
            }
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const lang = btn.dataset.lang;
                    
                    // Update button states
                    langButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Save language preference for current session
                    sessionStorage.setItem('selectedLanguage', lang);
                    
                    // Toggle language visibility
                    if (lang === 'en') {
                        enElements.forEach(el => el.style.display = '');
                        zhElements.forEach(el => el.style.display = 'none');
                        document.documentElement.lang = 'en';
                        updatePlaceholders('en');
                    } else {
                        enElements.forEach(el => el.style.display = 'none');
                        zhElements.forEach(el => el.style.display = '');
                        document.documentElement.lang = 'zh-TW';
                        updatePlaceholders('zh');
                    }
                    
                    // Regenerate questions in the new language
                    generateQuestions();
                });
            });
        }

        function updatePlaceholders(lang) {
            const nameInput = document.getElementById('studentName');
            const emailInput = document.getElementById('studentEmail');
            if (lang === 'en') {
                nameInput.placeholder = 'Enter your full name';
                emailInput.placeholder = 'Enter your email address';
            } else {
                nameInput.placeholder = '請輸入您的真實姓名';
                emailInput.placeholder = '請輸入您的電子郵件';
            }
        }

        // High-Quality Behavior Assessment Questions with Traditional Chinese Translations
        const questions = {
            en: [
                // Pleaser
                "I'm known for being flexible and accommodating to others' schedules and needs.",
                "Before sharing my opinion, I consider how it might affect the feelings of others.",
                "I'm good at finding common ground and expressing ideas in a way that resonates with people.",
                "I feel a sense of accomplishment when I can create a positive and harmonious environment for everyone.",
                "I'm open to reconsidering my views when presented with different perspectives from the group.",
                "I enjoy being a team player and am always willing to step up and help where needed.",
                "I often listen more than I speak, making sure everyone feels heard and valued.",
                "I choose my words carefully to ensure my message is received in the most constructive way possible.",
                "I'm quick to take responsibility to resolve misunderstandings and smooth things over.",
                "I prioritize the group's overall happiness and success, even if it means making personal compromises.",
                // Worrier
                "I'm skilled at identifying potential risks and planning for contingencies.",
                "I believe in being thorough and thinking through all potential outcomes before making a move.",
                "I feel most comfortable when I have a clear plan and know what to expect.",
                "I take decision-making very seriously, carefully weighing the pros and cons of each option.",
                "My attention to detail means I often catch potential errors that others might miss.",
                "I believe that careful risk assessment is the foundation of any successful project.",
                "I perform best in stable environments where processes are well-defined.",
                "I'm a proactive thinker, always considering future challenges and how to prepare for them.",
                "I prefer to have a comprehensive plan in place before starting a new project.",
                "I pride myself on being prepared for a wide range of situations.",
                // Prover
                "I am highly motivated by new challenges and opportunities to demonstrate my skills.",
                "I have a strong sense of urgency and am focused on delivering results efficiently.",
                "I believe that consistent high performance is the key to professional growth.",
                "I take pride in my ability to handle difficult situations independently.",
                "Once I complete a goal, I'm immediately eager to start on the next one.",
                "I hold myself to a high standard of performance and always strive to go the extra mile.",
                "I am very conscious of my professional image and strive to be seen as highly competent.",
                "I find that tangible results and achievements are the most meaningful measure of success.",
                "I'm driven to develop a wide range of skills to be effective in any situation.",
                "I prefer to figure things out on my own before asking for assistance.",
                // Critic
                "I believe in setting high benchmarks for quality in any work I'm involved with.",
                "I am driven by a desire to refine and improve things until they are the best they can be.",
                "I have a talent for spotting potential problems or areas for improvement that others might overlook.",
                "Even when a project is successful, I focus on the lessons learned for next time.",
                "I have a strong sense of accountability and take errors very seriously.",
                "I believe that constructive feedback is more valuable than simple praise.",
                "I believe that attention to the smallest details is what separates good work from great work.",
                "I operate with a clear sense of what is right and what needs to be done.",
                "I am always thinking about how we can elevate our current performance to the next level.",
                "I have a clear vision of excellence and am not easily satisfied with mediocrity.",
                // Avoider
                "I find that I'm most productive when a deadline is approaching.",
                "I believe that many problems resolve themselves if given enough time.",
                "When facing a major decision, I prefer to gather as much information as possible, even if it delays the outcome.",
                "I tend to focus my energy on things I know I can change, rather than on large, complex situations.",
                "Discussing the challenges of a situation helps me process it, even before I'm ready to act.",
                "I often feel it's better to wait for the right opportunity to act rather than forcing a solution.",
                "I value a team approach where the person best suited for a task takes the lead.",
                "I believe maintaining group harmony is often more important than debating every single point.",
                "I recognize that external factors often play a significant role in the outcome of a situation.",
                "I prefer to choose a proven path to success, even if a riskier option might offer a higher reward.",
                // Martyr
                "I derive a great deal of satisfaction from supporting others and putting their needs first.",
                "I prefer to handle things myself rather than burdening others with my requests.",
                "I'm the person people turn to when they need someone to take on a difficult or time-consuming task.",
                "I believe that rewards and personal time should come after my responsibilities are fully met.",
                "Sometimes, I feel that my efforts and contributions are not fully appreciated by others.",
                "I often give my all to a project or a person, without expecting anything in return.",
                "I'm very generous with my time and energy, even when my own resources are low.",
                "I have a strong sense of empathy and often feel responsible for the well-being of those around me.",
                "I'm energized by helping others, although it can sometimes leave me feeling drained.",
                "I believe that one of the most noble things a person can do is to dedicate themselves to the service of others."
            ],
            zh: [
                // Pleaser - 取悅者
                "我以能夠靈活配合他人的時程和需求而聞名。",
                "在分享我的意見之前，我會先考慮它可能對他人的感受產生什麼影響。",
                "我擅長尋找共同點，並以能引起共鳴的方式表達想法。",
                "當我能為大家創造一個正面和諧的環境時，我會很有成就感。",
                "當團隊提出不同觀點時，我對重新考慮自己的看法持開放態度。",
                "我樂於成為團隊的一份子，並且總是很願意在需要的地方挺身而出。",
                "我通常聽得多說得少，以確保每個人都感覺被傾聽和重視。",
                "我會謹慎選擇用詞，以確保我的訊息能以最具建設性的方式被接收。",
                "我會很快地承擔責任，以化解誤會並讓事情圓滿。",
                "我會優先考慮團隊整體的快樂與成功，即使這意味著需要做出個人妥協。",
                // Worrier - 擔憂者
                "我擅長識別潛在風險並為各種意外情況制定計畫。",
                "我相信在行動前，應該要徹底思考所有可能的結果。",
                "當我有明確的計畫並知道會發生什麼事時，我會感到最自在。",
                "我非常嚴肅地對待決策，會仔細權衡每個選項的利弊。",
                "我對細節的關注，意味著我經常能發現別人可能忽略的潛在錯誤。",
                "我相信謹慎的風險評估是任何成功專案的基礎。",
                "在流程定義明確的穩定環境中，我的表現最好。",
                "我是一個積極思考者，總是在考慮未來的挑戰以及如何為之準備。",
                "在開始一個新專案之前，我偏好先有一個周全的計畫。",
                "我為自己能對各種情況都做好準備而感到自豪。",
                // Prover - 證明者
                "新的挑戰和能展示我技能的機會，總能激勵我。",
                "我有強烈的急迫感，並專注於有效率地交付成果。",
                "我相信持續的高績效是職業成長的關鍵。",
                "我為自己能夠獨立處理困難情況的能力感到自豪。",
                "一旦完成一個目標，我會立刻渴望開始下一個。",
                "我對自己的表現有很高的標準，並且總是努力做到最好。",
                "我非常在意我的專業形象，並努力讓自己被視為非常有能力。",
                "我發現具體的成果和成就是最有意義的成功衡量標準。",
                "我致力於發展多方面的技能，以便在任何情況下都能應付自如。",
                "在尋求協助之前，我傾向於先自己想辦法解決問題。",
                // Critic - 批評者
                "我相信在我參與的任何工作中，都應該為品質設定高標準。",
                "我被一種渴望驅動，想要不斷改進事物直到它們達到最佳狀態。",
                "我有一種天賦，能發現別人可能忽略的潛在問題或可改進之處。",
                "即使專案成功了，我還是會專注於為下一次記取教訓。",
                "我有強烈的責任感，並非常嚴肅地看待錯誤。",
                "我相信建設性的回饋比單純的讚美更有價值。",
                "我相信對最小細節的關注，是區分「好」與「卓越」作品的關鍵。",
                "我對什麼是正確的、什麼是需要完成的有清晰的認知。",
                "我總是在思考如何將我們目前的表現提升到下一個層次。",
                "我對卓越有清晰的願景，且不容易對平庸感到滿意。",
                // Avoider - 迴避者
                "我發現在截止日期快到時，我的工作效率最高。",
                "我相信只要給予足夠的時間，許多問題會自行解決。",
                "面對重大決定時，我寧願盡可能收集資訊，即使這會延後結果。",
                "我傾向於將精力集中在我知道可以改變的事情上，而不是應對龐大複雜的局勢。",
                "討論一個情況的挑戰有助於我消化它，即使我還沒準備好採取行動。",
                "我常覺得等待適當的時機行動，比強行推出解決方案更好。",
                "我重視團隊合作，由最適合的人來主導任務。",
                "我相信維持團隊和諧，往往比爭論每一個觀點來得更重要。",
                "我體認到外在因素常常在事情的結果中扮演重要角色。",
                "我寧願選擇一條已經被證實的成功路徑，即使冒險可能帶來更高的回報。",
                // Martyr - 殉道者
                "我從支持他人並將他們的需​​求放在第一位中，獲得極大的滿足感。",
                "我寧願自己處理事情，也不願因我的請求而給別人帶來負擔。",
                "當人們需要有人承擔困難或耗時的任務時，他們會來找我。",
                "我相信獎勵和個人時間，應該在我完全履行職責之後才到來。",
                "有時候，我感覺到我的努力和貢獻沒有得到他人的充分賞識。",
                "我經常為一個專案或一個人付出我的全部，而不期望任何回報。",
                "即使在我自己的資源不足時，我對我的時間和精力也非常慷慨。",
                "我有強烈的同理心，並時常對周遭的人的幸福感感到有責任。",
                "幫助他人能給我帶來活力，儘管有時也會讓我感到精疲力竭。",
                "我相信一個人能做的最高尚的事情之一，就是致力於為他人服務。"
            ]
        };

        // Progress Tracking
        let currentProgress = 0;
        const totalQuestions = 60;

        // Create and shuffle the question order
        const randomizedOrder = Array.from({ length: totalQuestions }, (_, i) => i);
        // Fisher-Yates shuffle algorithm
        for (let i = randomizedOrder.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [randomizedOrder[i], randomizedOrder[j]] = [randomizedOrder[j], randomizedOrder[i]];
        }

        function updateProgress() {
            const progressNumber = document.getElementById('progressNumber');
            const progressRing = document.getElementById('progressRing');
            
            const percentage = Math.round((currentProgress / totalQuestions) * 100);
            
            // Update text
            progressNumber.textContent = currentProgress;
            
            // Update circular progress bar
            const circumference = 2 * Math.PI * 25; // radius is 25
            const offset = circumference - (percentage / 100) * circumference;
            progressRing.style.strokeDasharray = circumference;
            progressRing.style.strokeDashoffset = offset;
        }

        // Generate Questions
        function generateQuestions() {
            const container = document.getElementById('questionsContainer');
            const currentLang = document.querySelector('.lang-btn.active').dataset.lang;
            const questionSet = questions[currentLang];
            
            container.innerHTML = '';
            
            randomizedOrder.forEach((originalIndex, i) => {
                const question = questionSet[originalIndex];
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.dataset.originalIndex = originalIndex; // Store original index

                const labels = currentLang === 'en' ? 
                    ['Strongly Disagree', 'Disagree', 'Neutral', 'Agree', 'Strongly Agree'] :
                    ['非常不同意', '不同意', '中立', '同意', '非常同意'];

                questionDiv.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">${i + 1}</span>
                        <p class="question-text">${question}</p>
                    </div>
                    <div class="rating-container">
                        <div class="rating-options">
                            ${labels.map((label, value) => `
                                <div class="rating-option">
                                    <input type="radio" 
                                           id="q${i}_${value + 1}" 
                                           name="q${i}" 
                                           value="${value + 1}" 
                                           required
                                           data-question="${i}">
                                    <label for="q${i}_${value + 1}" class="rating-label">
                                        <span class="rating-number">${value + 1}</span>
                                        <span class="rating-text">${label}</span>
                                    </label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(questionDiv);
            });

            // Add event listeners for progress tracking
            const radioButtons = container.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', () => {
                    updateProgressFromAnswers();
                });
            });
        }

        function updateProgressFromAnswers() {
            const answeredQuestions = new Set();
            
            // Count answered questions by checking if any radio button is selected for each question
            for (let i = 0; i < totalQuestions; i++) {
                const questionRadios = document.querySelectorAll(`input[name="q${i}"]`);
                const isAnswered = Array.from(questionRadios).some(radio => radio.checked);
                if (isAnswered) {
                    answeredQuestions.add(`q${i}`);
                }
            }
            
            currentProgress = answeredQuestions.size;
            updateProgress();
            
            // Enable submit button when all questions are answered
            const submitBtn = document.getElementById('submitBtn');
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            
            if (currentProgress === totalQuestions && studentName && studentEmail) {
                submitBtn.disabled = false;
                submitBtn.classList.add('ready');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.remove('ready');
            }
        }

        // Form Submission
        document.getElementById('assessmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentName = document.getElementById('studentName').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            const currentLang = document.querySelector('.lang-btn.active').dataset.lang;
            
            // Validate inputs
            if (!studentName) {
                alert(currentLang === 'en' ? 'Please enter your name.' : '請輸入您的姓名。');
                return;
            }
            
            if (!studentEmail) {
                alert(currentLang === 'en' ? 'Please enter your email address.' : '請輸入您的電子郵件地址。');
                return;
            }
            
            // Collect answers
            const answers = [];
            const typeScores = [0, 0, 0, 0, 0, 0]; // 6 personality types
            
            const questionItems = document.querySelectorAll('.question-item');
            questionItems.forEach((q_item, i) => {
                const selectedRadio = q_item.querySelector(`input[name="q${i}"]:checked`);
                if (selectedRadio) {
                    const answerValue = parseInt(selectedRadio.value);
                    answers.push(answerValue); // Store answer in display order

                    const originalIndex = parseInt(q_item.dataset.originalIndex);
                    const typeIndex = Math.floor(originalIndex / 10);
                    typeScores[typeIndex] += answerValue;
                }
            });
            
            // Calculate percentages
            const typePercentages = typeScores.map(score => Math.round((score / 50) * 100));
            const totalScore = answers.reduce((sum, answer) => sum + answer, 0);
            
            // Determine dominant type
            const maxScore = Math.max(...typePercentages);
            const dominantTypeIndex = typePercentages.indexOf(maxScore);
            
            const typeNames = {
                en: ['Pleaser', 'Worrier', 'Prover', 'Critic', 'Avoider', 'Martyr'],
                zh: ['取悅者', '擔憂者', '證明者', '批評者', '迴避者', '殉道者']
            };
            
            const resultCategory = typeNames[currentLang][dominantTypeIndex];
            const resultDescription = currentLang === 'en' ? 
                `Your dominant behavioral pattern is ${resultCategory} with ${maxScore}% tendency. This indicates your primary psychological approach to challenges and relationships.` :
                `您的主要行為模式是${resultCategory}，傾向度為${maxScore}%。這顯示了您面對挑戰和人際關係的主要心理方式。`;
            
            // Prepare email content
            const emailContent = `
                Student Name: ${studentName}
                Assessment: Personality Behavior Pattern Assessment
                Completion Date: ${new Date().toLocaleString()}
                
                Results Summary:
                Total Score: ${totalScore}/${totalQuestions * 5}
                Dominant Type: ${resultCategory} (${maxScore}%)
                
                Type Breakdown:
                ${typeNames.en.map((name, index) => `${name}: ${typePercentages[index]}%`).join('\n')}
                
                Description: ${resultDescription}
                
                Individual Question Responses:
                ${answers.map((answer, index) => `Question ${index + 1}: ${answer}/5`).join('\n')}
            `;
            
            try {
                // Store results and redirect (skip email for now)
                sessionStorage.setItem('assessmentResults', JSON.stringify({
                    studentName,
                    testType: 'Personality Behavior Pattern Assessment',
                    totalScore,
                    resultCategory,
                    resultDescription,
                    typePercentages,
                    answers,
                    completionDate: new Date().toLocaleString()
                }));
                
                // Try to send email but don't block on failure
                try {
                    // Create type breakdown for personality assessment
                    const typeNames = currentLang === 'en' ? 
                        ['Pleaser', 'Worrier', 'Prover', 'Critic', 'Avoider', 'Martyr'] :
                        ['取悅者', '擔憂者', '證明者', '批評者', '迴避者', '殉道者'];
                    
                    const breakdownHtml = `
                        <div style="background-color: white; border-radius: 8px; padding: 16px; margin-top: 16px;">
                            <h5 style="margin: 0 0 12px 0; color: #667eea; font-size: 14px;">${currentLang === 'en' ? 'Personality Type Breakdown:' : '人格類型分析：'}</h5>
                            ${typePercentages.map((percentage, index) => {
                                const isTop = percentage === maxScore;
                                return `<div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 6px 12px; background-color: ${isTop ? '#f0f4ff' : '#f8f9fa'}; border-radius: 4px; ${isTop ? 'border-left: 3px solid #667eea;' : ''}">
                                    <span style="font-size: 13px; color: #555;">${typeNames[index]}${isTop ? ' ⭐' : ''}</span>
                                    <span style="font-weight: ${isTop ? 'bold' : 'normal'}; color: ${isTop ? '#667eea' : '#666'}; font-size: 13px;">${percentage}%</span>
                                </div>`;
                            }).join('')}
                        </div>
                    `;
                    
                    // Prepare multilingual email content
                    const emailData = {
                        student_name: studentName,
                        student_email: studentEmail || document.getElementById('studentEmail').value,
                        test_type: currentLang === 'en' ? "Personality Behavior Pattern Assessment" : "人格行為模式評估",
                        completion_date: new Date().toLocaleDateString(),
                        message: emailContent,
                        
                        // Header content
                        header_emoji: "🧠",
                        header_title: currentLang === 'en' ? "Personality Results" : "人格評估結果",
                        
                        // Greeting and messages
                        greeting: currentLang === 'en' ? "Hello" : "您好",
                        completion_message: currentLang === 'en' ? 
                            "Thank you for completing the Personality Behavior Pattern Assessment! Your detailed personality analysis is ready." :
                            "感謝您完成人格行為模式評估！您的詳細人格分析已準備好。",
                            
                        // Results section
                        results_title: currentLang === 'en' ? "Your Personality Profile" : "您的人格檔案",
                        main_score: `${maxScore}%`,
                        score_label: currentLang === 'en' ? "Dominant Pattern Strength" : "主要模式強度",
                        result_category: resultCategory,
                        result_description: resultDescription,
                        breakdown_section: breakdownHtml,
                        
                        // Insights
                        insights_title: currentLang === 'en' ? "Understanding Your Results" : "理解您的結果",
                        insights_text: currentLang === 'en' ? 
                            "Your personality profile reveals patterns in how you think, feel, and behave. Use these insights to understand your natural tendencies and identify opportunities for personal growth." :
                            "您的人格檔案揭示了您思考、感受和行為的模式。請利用這些洞察來了解您的自然傾向並識別個人成長的機會。",
                            
                        // Footer content
                        detailed_title: currentLang === 'en' ? "Complete Assessment Data" : "完整評估數據",
                        completion_date_label: currentLang === 'en' ? "Assessment completed on:" : "評估完成日期：",
                        questions_text: currentLang === 'en' ? "Questions about your results?" : "對結果有疑問？",
                        disclaimer_text: currentLang === 'en' ? 
                            "This personality assessment is designed for educational and self-development purposes. Results should be used as a guide for personal reflection and growth." :
                            "此人格評估用於教育和自我發展目的。結果應作為個人反思和成長的指南。",
                        footer_brand: currentLang === 'en' ? "Personality Assessment Team" : "人格評估測試團隊",
                        footer_subtitle: currentLang === 'en' ? "Professional Psychological Evaluation" : "專業心理評估"
                    };
                    
                    // Send to user
                    await emailjs.send("service_2mndbrx", "template_z0l98oa", emailData);
                    
                    // Send to admin (always in English for admin)
                    const adminEmailData = { ...emailData };
                    adminEmailData.student_email = "felicco@gmail.com";
                    adminEmailData.test_type = "Personality Behavior Pattern Assessment";
                    adminEmailData.header_title = "Personality Results";
                    adminEmailData.greeting = "Hello";
                    adminEmailData.completion_message = `${studentName} has completed the Personality Behavior Pattern Assessment. Results summary attached.`;
                    
                    await emailjs.send("service_2mndbrx", "template_z0l98oa", adminEmailData);
                    
                    console.log('Emails sent successfully');
                } catch (emailError) {
                    console.log('Email failed but continuing to results:', emailError);
                }
                
                window.location.href = 'results.html';
                
            } catch (error) {
                console.error('Error processing assessment:', error);
                alert(currentLang === 'en' ? 
                    'There was an error processing your results. Please try again.' :
                    '處理您的結果時發生錯誤，請重試。');
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeLanguageToggle();
            generateQuestions();
            updateProgress();
            
            // Add input listeners for real-time validation
            document.getElementById('studentName').addEventListener('input', updateProgressFromAnswers);
            document.getElementById('studentEmail').addEventListener('input', updateProgressFromAnswers);
        });
    </script>

    <!-- Floating Progress Indicator - positioned above scale reference -->
    <div id="progressIndicator" class="floating-progress floating-progress-stacked">
        <div class="progress-circle">
            <svg class="progress-ring" width="60" height="60">
                <circle class="progress-ring-background" cx="30" cy="30" r="25"></circle>
                <circle class="progress-ring-progress" cx="30" cy="30" r="25" id="progressRing"></circle>
            </svg>
            <div class="progress-text">
                <span id="progressNumber">0</span>
                <span class="progress-total">/60</span>
            </div>
        </div>
        <div class="progress-label-text">
            <span class="text-en">Progress</span>
            <span class="text-zh" style="display: none;">進度</span>
        </div>
    </div>
</body>
</html> 